# ЧАСТЬ 2. ПРОЕКТИРОВАНИЕ СИСТЕМЫ

## 2.1. Разработка архитектуры системы

### 2.1.1. Общая архитектура веб-приложения

Разработанное веб-приложение построено на основе **трехуровневой клиент-серверной архитектуры**, которая обеспечивает разделение ответственности между компонентами системы и упрощает масштабирование и сопровождение.

**Уровни архитектуры:**

```
┌─────────────────────────────────────────────────────────────┐
│                      УРОВЕНЬ 1: КЛИЕНТ                      │
│                     (Presentation Layer)                    │
├─────────────────────────────────────────────────────────────┤
│  • Веб-браузер пользователя (Chrome, Firefox, Safari)      │
│  • React-приложение (Single Page Application)              │
│  • Адаптивный интерфейс (мобильные, планшеты, десктопы)   │
│  • Redux Store для управления состоянием                   │
└─────────────────────────────────────────────────────────────┘
                            ↕ HTTP/HTTPS
                         (REST API)
┌─────────────────────────────────────────────────────────────┐
│                   УРОВЕНЬ 2: СЕРВЕР ПРИЛОЖЕНИЙ              │
│                     (Application Layer)                     │
├─────────────────────────────────────────────────────────────┤
│  • FastAPI (бизнес-логика и обработка запросов)            │
│  • JWT-аутентификация и авторизация                        │
│  • Валидация данных (Pydantic)                             │
│  • Бизнес-сервисы (UserService, ProductService, etc.)     │
│  • Обработка файлов (изображения товаров)                 │
│  • Генерация PDF-отчетов                                   │
│  • WebSocket для real-time уведомлений                     │
└─────────────────────────────────────────────────────────────┘
                            ↕ SQL
                        (SQLAlchemy)
┌─────────────────────────────────────────────────────────────┐
│                   УРОВЕНЬ 3: БАЗА ДАННЫХ                    │
│                       (Data Layer)                          │
├─────────────────────────────────────────────────────────────┤
│  • PostgreSQL (production) / SQLite (development)          │
│  • Хранение данных пользователей, товаров, заказов        │
│  • Обеспечение целостности данных (constraints, triggers)  │
│  • Индексы для оптимизации запросов                        │
└─────────────────────────────────────────────────────────────┘
```

---

### 2.1.2. Взаимодействие компонентов системы

**Типичный сценарий работы системы (на примере добавления товара в корзину):**

1. **Действие пользователя**
   - Пользователь открывает веб-браузер и переходит на сайт `http://localhost:5173`
   - Браузер загружает React-приложение (HTML, CSS, JavaScript)
   - Пользователь просматривает каталог товаров и нажимает кнопку "Добавить в корзину"

2. **Обработка на клиенте (Frontend)**
   - React-компонент `ProductCard` перехватывает событие клика
   - Redux Action `addToCart()` отправляется в Store
   - Axios отправляет HTTP POST запрос на сервер:
     ```
     POST http://localhost:8000/api/v1/cart/add
     Headers: Authorization: Bearer <JWT_TOKEN>
     Body: { "product_id": 123, "quantity": 1 }
     ```

3. **Обработка на сервере (Backend)**
   - Nginx (в production) или Uvicorn получает запрос
   - FastAPI маршрутизирует запрос к endpoint `/api/v1/cart/add`
   - Middleware проверяет JWT-токен и извлекает ID пользователя
   - Pydantic валидирует данные запроса (product_id - число, quantity > 0)
   - CartService выполняет бизнес-логику:
     - Проверяет наличие товара на складе
     - Проверяет, нет ли уже товара в корзине (обновить количество)
     - Вызывает метод создания записи в БД

4. **Работа с базой данных**
   - SQLAlchemy ORM формирует SQL-запрос:
     ```sql
     INSERT INTO cart_items (user_id, product_id, quantity)
     VALUES (42, 123, 1)
     ON CONFLICT (user_id, product_id) 
     DO UPDATE SET quantity = cart_items.quantity + 1
     ```
   - PostgreSQL выполняет запрос и возвращает результат
   - Транзакция фиксируется (COMMIT)

5. **Возврат ответа клиенту**
   - FastAPI формирует JSON-ответ:
     ```json
     {
       "success": true,
       "message": "Товар добавлен в корзину",
       "cart_items_count": 3
     }
     ```
   - HTTP Response 200 OK отправляется обратно в браузер

6. **Обновление интерфейса**
   - Axios получает ответ и обновляет Redux Store
   - React re-render обновляет значок корзины (показывает "3 товара")
   - Отображается toast-уведомление "Товар добавлен в корзину"

---

### 2.1.3. Функциональные модули системы

Веб-приложение разделено на три основных функциональных модуля в зависимости от ролей пользователей.

---

#### Модуль 1: Панель покупателя (Customer Module)

**Назначение:** Предоставляет функции для обычных покупателей магазина.

**Основные компоненты:**

1. **Модуль каталога товаров**
   - Просмотр всех доступных товаров с фильтрацией по категориям
   - Поиск товаров по названию
   - Детальная информация о товаре (фото, цена, описание, наличие)
   - Система отзывов и рейтингов

2. **Модуль корзины покупок**
   - Добавление/удаление товаров
   - Изменение количества единиц товара
   - Автоматический расчет итоговой стоимости
   - Очистка всей корзины

3. **Модуль избранного (Wishlist)**
   - Добавление понравившихся товаров в список желаний
   - Быстрое перемещение товаров из избранного в корзину
   - Управление списком избранного

4. **Модуль оформления заказа (Checkout)**
   - Ввод данных доставки (адрес, телефон)
   - Выбор способа оплаты
   - Подтверждение заказа
   - Получение уведомления об успешном создании заказа

5. **Модуль истории заказов**
   - Просмотр всех оформленных заказов
   - Детальная информация о каждом заказе (состав, статус, сумма)
   - Отслеживание статуса выполнения заказа

6. **Модуль личного кабинета**
   - Просмотр и редактирование профиля
   - Изменение пароля
   - Управление адресами доставки

**Технологии:**
- React компоненты: `HomePage`, `ProductDetailsPage`, `CartPage`, `CheckoutPage`, `OrdersPage`
- Redux slices: `authSlice`, `cartSlice`, `wishlistSlice`, `orderSlice`

---

#### Модуль 2: Панель продавца (Seller Module)

**Назначение:** Инструменты для управления товарами и отслеживания продаж.

**Основные компоненты:**

1. **Модуль управления товарами**
   - Создание новых товаров (название, описание, цена, категория, количество)
   - Загрузка фотографий товаров (до 5 изображений на товар)
   - Редактирование информации о товарах
   - Удаление товаров (с проверкой на наличие в заказах)
   - Управление остатками на складе

2. **Модуль категорий**
   - Создание новых категорий товаров
   - Редактирование и удаление категорий
   - Просмотр товаров в каждой категории

3. **Модуль просмотра заказов**
   - Список всех заказов с товарами продавца
   - Фильтрация заказов по статусу (новые, в обработке, выполнены)
   - Детальная информация о заказе (покупатель, товары, сумма)

4. **Модуль аналитики продаж**
   - График продаж по дням/неделям/месяцам
   - Топ-5 самых продаваемых товаров
   - Общая выручка и количество заказов
   - Средний чек

5. **Модуль отзывов**
   - Просмотр отзывов покупателей на товары продавца
   - Ответы на отзывы
   - Модерация негативных отзывов

**Технологии:**
- React компоненты: `SellerPage`, `ProductForm`, `PhotoUpload`, `SellerAnalytics`
- Services: `ProductService`, `OrderService`, `ReviewService`

---

#### Модуль 3: Панель администратора (Admin Module)

**Назначение:** Полный контроль над системой и бизнес-процессами.

**Основные компоненты:**

1. **Административная панель (Dashboard)**
   - Общая статистика: количество пользователей, товаров, заказов
   - Общая выручка и средний чек
   - График продаж за последние 7 дней
   - Список последних 5 заказов с быстрым просмотром

2. **Модуль управления пользователями**
   - Просмотр списка всех пользователей (покупатели, продавцы, администраторы)
   - Поиск пользователей по email или имени
   - Фильтрация по ролям (customer, seller, admin)
   - Изменение роли пользователя
   - Блокировка/разблокировка учетных записей
   - Удаление пользователей

3. **Модуль управления товарами**
   - Просмотр всех товаров в системе (от всех продавцов)
   - Редактирование и удаление любых товаров
   - Модерация новых товаров перед публикацией (опционально)
   - Массовое изменение цен или категорий

4. **Модуль управления заказами**
   - Полный список всех заказов в системе
   - Поиск заказов по ID, email покупателя или дате
   - Фильтрация по статусу (pending, processing, completed, cancelled)
   - Изменение статуса заказа
   - Отмена проблемных заказов
   - Просмотр деталей заказа (покупатель, товары, адрес доставки, оплата)

5. **Модуль управления категориями**
   - Создание глобальных категорий товаров
   - Переименование и удаление категорий
   - Перенос товаров между категориями

6. **Модуль аналитики и отчетности**
   - Генерация PDF-отчетов о продажах за период
   - Экспорт данных в Excel (CSV)
   - Аналитика по категориям товаров
   - Аналитика по продавцам (кто продал больше всего)
   - Финансовая отчетность (выручка, прибыль)

7. **Модуль безопасности и логов**
   - Просмотр логов действий пользователей
   - Мониторинг подозрительной активности
   - Управление правами доступа

**Технологии:**
- React компоненты: `AdminPage`, `AdminDashboard`, `UsersManagement`, `OrdersManagement`, `ProductsManagement`
- Services: `UserService`, `OrderService`, `PDFService`

---

### 2.1.4. Архитектура API (Application Programming Interface)

Backend предоставляет **RESTful API** для взаимодействия с клиентской частью. Всего реализовано **59 endpoints**, разделенных на 13 модулей.

**Структура API:**

```
/api/v1/
├── auth/                 # Аутентификация и регистрация (4 endpoint)
│   ├── POST   /register
│   ├── POST   /login
│   ├── GET    /me
│   └── PUT    /me
│
├── users/                # Управление пользователями (8 endpoints)
│   ├── GET    /
│   ├── GET    /{user_id}
│   ├── POST   /
│   ├── PUT    /{user_id}
│   ├── DELETE /{user_id}
│   ├── POST   /{user_id}/change-role
│   ├── POST   /{user_id}/toggle-active
│   └── GET    /stats
│
├── products/             # Управление товарами (10 endpoints)
│   ├── GET    /
│   ├── GET    /{product_id}
│   ├── POST   /
│   ├── PUT    /{product_id}
│   ├── DELETE /{product_id}
│   ├── GET    /seller/my
│   ├── GET    /category/{category_id}
│   ├── POST   /search
│   ├── GET    /featured
│   └── GET    /top-selling
│
├── categories/           # Управление категориями (5 endpoints)
│   ├── GET    /
│   ├── GET    /{category_id}
│   ├── POST   /
│   ├── PUT    /{category_id}
│   └── DELETE /{category_id}
│
├── cart/                 # Корзина покупок (5 endpoints)
│   ├── GET    /
│   ├── POST   /add
│   ├── PUT    /update/{item_id}
│   ├── DELETE /remove/{item_id}
│   └── DELETE /clear
│
├── wishlist/             # Избранное (4 endpoints)
│   ├── GET    /
│   ├── POST   /add
│   ├── DELETE /remove/{product_id}
│   └── POST   /move-to-cart/{product_id}
│
├── orders/               # Заказы (9 endpoints)
│   ├── GET    /
│   ├── GET    /my
│   ├── GET    /{order_id}
│   ├── POST   /create
│   ├── PUT    /{order_id}/status
│   ├── DELETE /{order_id}
│   ├── GET    /seller/my
│   ├── GET    /stats
│   └── POST   /export-pdf
│
├── reviews/              # Отзывы (5 endpoints)
│   ├── GET    /product/{product_id}
│   ├── POST   /product/{product_id}
│   ├── PUT    /{review_id}
│   ├── DELETE /{review_id}
│   └── GET    /my
│
├── payments/             # Платежи (3 endpoints)
│   ├── POST   /create-payment
│   ├── GET    /status/{payment_id}
│   └── POST   /confirm/{payment_id}
│
├── wallet/               # Кошелек (4 endpoints)
│   ├── GET    /
│   ├── POST   /deposit
│   ├── GET    /transactions
│   └── POST   /withdraw
│
├── analytics/            # Аналитика (4 endpoints)
│   ├── GET    /dashboard
│   ├── GET    /sales-chart
│   ├── GET    /top-products
│   └── GET    /revenue-stats
│
├── uploads/              # Загрузка файлов (2 endpoints)
│   ├── POST   /image
│   └── DELETE /image/{filename}
│
└── websocket/            # WebSocket соединение (1 endpoint)
    └── WS     /ws/{user_id}
```

**Принципы построения API:**

1. **RESTful стандарт**: использование HTTP методов (GET, POST, PUT, DELETE) согласно их семантике
2. **Версионирование**: префикс `/api/v1/` для возможности создания v2 без ломки старых клиентов
3. **Единообразные ответы**: все endpoints возвращают JSON с полями `success`, `data`, `message`
4. **Коды статусов HTTP**: 200 (OK), 201 (Created), 400 (Bad Request), 401 (Unauthorized), 404 (Not Found), 500 (Server Error)
5. **Аутентификация**: Bearer Token (JWT) передается в заголовке `Authorization`
6. **Документация**: автоматическая генерация Swagger UI по адресу `/docs`

---

### 2.1.5. Механизм аутентификации и авторизации

Для обеспечения безопасности системы реализован механизм на основе **JWT (JSON Web Tokens)**.

**Процесс аутентификации:**

```
1. Регистрация пользователя
   ┌──────────┐                  ┌──────────┐                 ┌──────────┐
   │ Клиент   │                  │  Сервер  │                 │    БД    │
   └────┬─────┘                  └────┬─────┘                 └────┬─────┘
        │ POST /auth/register         │                            │
        │ {email, password, name}     │                            │
        │─────────────────────────────>                            │
        │                              │ Хеширование пароля        │
        │                              │ (bcrypt)                  │
        │                              │                           │
        │                              │ INSERT INTO users         │
        │                              │───────────────────────────>
        │                              │                           │
        │                              │<───────────────────────────
        │                              │ user_id = 123             │
        │                              │                           │
        │                              │ Генерация JWT-токена      │
        │                              │ (срок действия: 7 дней)   │
        │                              │                           │
        │<─────────────────────────────│                           │
        │ {token: "eyJhbGc...",        │                           │
        │  user: {...}}                │                           │
        │                              │                           │
   ┌────▼─────┐                  ┌────▼─────┐                 ┌────▼─────┐
   │ Клиент   │                  │  Сервер  │                 │    БД    │
   │ Сохраняет│                  └──────────┘                 └──────────┘
   │ токен в  │
   │ localStorage │
   └──────────┘

2. Вход в систему
   ┌──────────┐                  ┌──────────┐                 ┌──────────┐
   │ Клиент   │                  │  Сервер  │                 │    БД    │
   └────┬─────┘                  └────┬─────┘                 └────┬─────┘
        │ POST /auth/login            │                            │
        │ {email, password}           │                            │
        │─────────────────────────────>                            │
        │                              │ SELECT * FROM users       │
        │                              │ WHERE email = ?           │
        │                              │───────────────────────────>
        │                              │                           │
        │                              │<───────────────────────────
        │                              │ user + hashed_password    │
        │                              │                           │
        │                              │ Проверка пароля           │
        │                              │ bcrypt.verify()           │
        │                              │                           │
        │                              │ Генерация JWT             │
        │                              │                           │
        │<─────────────────────────────│                           │
        │ {token: "eyJhbGc...",        │                           │
        │  user: {...}}                │                           │

3. Доступ к защищенным ресурсам
   ┌──────────┐                  ┌──────────┐                 ┌──────────┐
   │ Клиент   │                  │  Сервер  │                 │    БД    │
   └────┬─────┘                  └────┬─────┘                 └────┬─────┘
        │ GET /api/v1/orders/my       │                            │
        │ Authorization: Bearer <JWT> │                            │
        │─────────────────────────────>                            │
        │                              │ Проверка JWT              │
        │                              │ jose.decode()             │
        │                              │                           │
        │                              │ Извлечение user_id        │
        │                              │                           │
        │                              │ SELECT * FROM orders      │
        │                              │ WHERE user_id = ?         │
        │                              │───────────────────────────>
        │                              │                           │
        │                              │<───────────────────────────
        │<─────────────────────────────│ orders data               │
        │ {orders: [...]}              │                           │
```

**Роли пользователей и права доступа:**

| Endpoint | Customer | Seller | Admin |
|----------|----------|--------|-------|
| GET /products | ✅ | ✅ | ✅ |
| POST /products | ❌ | ✅ | ✅ |
| DELETE /products/{id} | ❌ | ✅ (только свои) | ✅ (любые) |
| GET /orders/my | ✅ | ✅ | ✅ |
| GET /orders/ (все заказы) | ❌ | ❌ | ✅ |
| POST /users/{id}/change-role | ❌ | ❌ | ✅ |
| GET /analytics/dashboard | ❌ | ✅ (свои данные) | ✅ (все данные) |

---

### 2.1.6. Обработка ошибок и исключений

Система использует централизованную обработку ошибок для обеспечения консистентности ответов.

**Типы ошибок:**

1. **Ошибки валидации (400 Bad Request)**
   ```json
   {
     "success": false,
     "message": "Validation Error",
     "errors": [
       {"field": "email", "message": "Invalid email format"},
       {"field": "price", "message": "Price must be greater than 0"}
     ]
   }
   ```

2. **Ошибки аутентификации (401 Unauthorized)**
   ```json
   {
     "success": false,
     "message": "Invalid token or token expired"
   }
   ```

3. **Ошибки авторизации (403 Forbidden)**
   ```json
   {
     "success": false,
     "message": "You don't have permission to perform this action"
   }
   ```

4. **Ошибки "не найдено" (404 Not Found)**
   ```json
   {
     "success": false,
     "message": "Product with id=123 not found"
   }
   ```

5. **Серверные ошибки (500 Internal Server Error)**
   ```json
   {
     "success": false,
     "message": "Internal server error. Please try again later.",
     "error_id": "ERR-20260202-1234"
   }
   ```

---

## 2.2. Проектирование базы данных

### 2.2.1. Инфологическая модель данных

База данных системы спроектирована для хранения информации о пользователях, товарах, заказах и других сущностях торгового процесса.

**Основные сущности (таблицы):**

1. **Users (Пользователи)** - информация о всех пользователях системы
2. **Products (Товары)** - каталог всех товаров магазина
3. **Categories (Категории)** - категории для классификации товаров
4. **Orders (Заказы)** - информация о заказах покупателей
5. **OrderItems (Позиции заказа)** - связь заказов и товаров (что именно заказано)
6. **CartItems (Корзина)** - товары в корзине пользователя
7. **WishlistItems (Избранное)** - список желаний пользователя
8. **Reviews (Отзывы)** - отзывы покупателей на товары
9. **Wallets (Кошельки)** - балансы пользователей для оплаты

---

### 2.2.2. Детальное описание таблиц базы данных

#### Таблица 1: users

**Назначение:** Хранение информации о пользователях системы (покупатели, продавцы, администраторы).

| Поле | Тип данных | Ограничения | Описание |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Уникальный идентификатор пользователя |
| email | VARCHAR(255) | UNIQUE, NOT NULL | Email для входа в систему |
| password_hash | VARCHAR(255) | NOT NULL | Хешированный пароль (bcrypt) |
| first_name | VARCHAR(100) | NOT NULL | Имя пользователя |
| last_name | VARCHAR(100) | NOT NULL | Фамилия пользователя |
| phone | VARCHAR(20) | NULL | Контактный телефон |
| address | TEXT | NULL | Адрес доставки |
| role | VARCHAR(20) | NOT NULL, DEFAULT 'customer' | Роль: customer, seller, admin |
| is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | Активен ли аккаунт |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата регистрации |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата последнего обновления |

**Индексы:**
- `idx_users_email` на поле `email` - для быстрого поиска при входе
- `idx_users_role` на поле `role` - для фильтрации по ролям

---

#### Таблица 2: categories

**Назначение:** Категории товаров для структурирования каталога.

| Поле | Тип данных | Ограничения | Описание |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Уникальный идентификатор категории |
| name | VARCHAR(100) | UNIQUE, NOT NULL | Название категории (например, "Молочные продукты") |
| description | TEXT | NULL | Описание категории |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата создания |

**Примеры категорий:**
- Молочные продукты
- Хлебобулочные изделия
- Мясо и птица
- Овощи и фрукты
- Напитки
- Бакалея

---

#### Таблица 3: products

**Назначение:** Хранение информации о товарах магазина.

| Поле | Тип данных | Ограничения | Описание |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Уникальный идентификатор товара |
| name | VARCHAR(255) | NOT NULL | Название товара |
| description | TEXT | NULL | Подробное описание |
| price | DECIMAL(10, 2) | NOT NULL, CHECK (price >= 0) | Цена товара |
| stock_quantity | INTEGER | NOT NULL, DEFAULT 0, CHECK (stock_quantity >= 0) | Количество на складе |
| category_id | INTEGER | FOREIGN KEY → categories(id), NULL | Категория товара |
| seller_id | INTEGER | FOREIGN KEY → users(id), NOT NULL | Продавец товара |
| image_urls | JSON | NULL | Массив URL изображений товара |
| is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | Активен ли товар (отображается в каталоге) |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата добавления |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата последнего обновления |

**Индексы:**
- `idx_products_category` на поле `category_id` - для фильтрации по категориям
- `idx_products_seller` на поле `seller_id` - для выборки товаров продавца
- `idx_products_price` на поле `price` - для сортировки по цене

**Пример записи:**
```
id: 45
name: "Молоко 'Веселый молочник' 3.2%"
description: "Пастеризованное молоко высшего качества"
price: 450.00
stock_quantity: 120
category_id: 1 (Молочные продукты)
seller_id: 7
image_urls: ["static/uploads/products/milk_front.jpg", "static/uploads/products/milk_back.jpg"]
is_active: true
```

---

#### Таблица 4: orders

**Назначение:** Информация о заказах покупателей.

| Поле | Тип данных | Ограничения | Описание |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Уникальный номер заказа |
| user_id | INTEGER | FOREIGN KEY → users(id), NOT NULL | Покупатель |
| total_amount | DECIMAL(10, 2) | NOT NULL, CHECK (total_amount >= 0) | Общая сумма заказа |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'pending' | Статус: pending, processing, completed, cancelled |
| delivery_address | TEXT | NOT NULL | Адрес доставки |
| phone | VARCHAR(20) | NOT NULL | Контактный телефон |
| payment_method | VARCHAR(20) | NOT NULL | Способ оплаты: wallet, card, cash |
| notes | TEXT | NULL | Комментарии к заказу |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата создания заказа |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата последнего обновления |

**Индексы:**
- `idx_orders_user` на поле `user_id` - для выборки заказов пользователя
- `idx_orders_status` на поле `status` - для фильтрации по статусу
- `idx_orders_created_at` на поле `created_at` - для сортировки по дате

**Возможные статусы заказа:**
- `pending` - ожидает подтверждения
- `processing` - в обработке (комплектуется)
- `completed` - выполнен (доставлен)
- `cancelled` - отменен

---

#### Таблица 5: order_items

**Назначение:** Состав заказа (какие товары и в каком количестве входят в заказ).

| Поле | Тип данных | Ограничения | Описание |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Уникальный идентификатор позиции |
| order_id | INTEGER | FOREIGN KEY → orders(id), ON DELETE CASCADE, NOT NULL | Заказ |
| product_id | INTEGER | FOREIGN KEY → products(id), ON DELETE RESTRICT, NOT NULL | Товар |
| quantity | INTEGER | NOT NULL, CHECK (quantity > 0) | Количество единиц товара |
| price_at_purchase | DECIMAL(10, 2) | NOT NULL | Цена товара на момент покупки |
| subtotal | DECIMAL(10, 2) | NOT NULL | Итого за позицию (quantity * price) |

**Важно:** 
- `ON DELETE CASCADE` для order_id - при удалении заказа удаляются и его позиции
- `ON DELETE RESTRICT` для product_id - нельзя удалить товар, который присутствует в заказах (сохранение истории)
- `price_at_purchase` фиксирует цену на момент покупки, даже если позже цена в каталоге изменится

**Составной индекс:**
- `idx_order_items_order_product` на `(order_id, product_id)` - уникальность товара в заказе

**Пример:**
```
Заказ #1234:
  - Позиция 1: Молоко, 2 шт., цена 450 тг, итого 900 тг
  - Позиция 2: Хлеб, 1 шт., цена 200 тг, итого 200 тг
  - Позиция 3: Сыр, 1 шт., цена 1500 тг, итого 1500 тг
Итого заказ: 2600 тг
```

---

#### Таблица 6: cart_items

**Назначение:** Корзина покупок пользователя (временное хранилище до оформления заказа).

| Поле | Тип данных | Ограничения | Описание |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Уникальный идентификатор записи |
| user_id | INTEGER | FOREIGN KEY → users(id), ON DELETE CASCADE, NOT NULL | Пользователь |
| product_id | INTEGER | FOREIGN KEY → products(id), ON DELETE CASCADE, NOT NULL | Товар |
| quantity | INTEGER | NOT NULL, CHECK (quantity > 0) | Количество |
| added_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата добавления в корзину |

**Уникальный индекс:**
- `uq_cart_user_product` на `(user_id, product_id)` - один товар может быть в корзине только один раз (при повторном добавлении увеличивается quantity)

**Отличие от order_items:**
- Корзина - временное хранилище, заказ - постоянная история
- При оформлении заказа данные копируются из cart_items в order_items, после чего корзина очищается

---

#### Таблица 7: wishlist_items

**Назначение:** Список избранных товаров (список желаний).

| Поле | Тип данных | Ограничения | Описание |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Уникальный идентификатор |
| user_id | INTEGER | FOREIGN KEY → users(id), ON DELETE CASCADE, NOT NULL | Пользователь |
| product_id | INTEGER | FOREIGN KEY → products(id), ON DELETE CASCADE, NOT NULL | Товар |
| added_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата добавления |

**Уникальный индекс:**
- `uq_wishlist_user_product` на `(user_id, product_id)` - один товар один раз в избранном

---

#### Таблица 8: reviews

**Назначение:** Отзывы покупателей на товары.

| Поле | Тип данных | Ограничения | Описание |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Уникальный идентификатор отзыва |
| user_id | INTEGER | FOREIGN KEY → users(id), ON DELETE CASCADE, NOT NULL | Автор отзыва |
| product_id | INTEGER | FOREIGN KEY → products(id), ON DELETE CASCADE, NOT NULL | Товар |
| rating | INTEGER | NOT NULL, CHECK (rating >= 1 AND rating <= 5) | Оценка от 1 до 5 звезд |
| comment | TEXT | NULL | Текст отзыва |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата создания |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата редактирования |

**Индексы:**
- `idx_reviews_product` на `product_id` - для выборки всех отзывов товара
- `idx_reviews_user` на `user_id` - для просмотра всех отзывов пользователя

**Ограничение:** Один пользователь может оставить только один отзыв на товар
- Уникальный индекс `uq_review_user_product` на `(user_id, product_id)`

---

#### Таблица 9: wallets

**Назначение:** Виртуальные кошельки пользователей для оплаты заказов.

| Поле | Тип данных | Ограничения | Описание |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Уникальный идентификатор кошелька |
| user_id | INTEGER | FOREIGN KEY → users(id), UNIQUE, ON DELETE CASCADE, NOT NULL | Пользователь (один кошелек на пользователя) |
| balance | DECIMAL(10, 2) | NOT NULL, DEFAULT 0.00, CHECK (balance >= 0) | Баланс кошелька |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата создания |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Дата последнего обновления |

**Особенности:**
- При регистрации пользователя автоматически создается кошелек с балансом 0
- Баланс не может быть отрицательным (CHECK constraint)
- Пополнение баланса происходит через endpoint `/api/v1/wallet/deposit`
- При оплате заказа через wallet баланс уменьшается на сумму заказа

---

### 2.2.3. ER-диаграмма (Entity-Relationship Diagram)

ER-диаграмма наглядно показывает взаимосвязи между таблицами базы данных.

```
┌────────────────────┐
│      USERS         │
├────────────────────┤
│ • id (PK)          │
│ • email (UNIQUE)   │
│ • password_hash    │
│ • first_name       │
│ • last_name        │
│ • role             │
│ • is_active        │
└──────┬─────────────┘
       │
       │ 1
       │
       │ (seller_id)
       │ (user_id)
       ├──────────────────────────┐
       │                          │
       │ N                        │ N
       │                          │
┌──────▼─────────┐         ┌──────▼─────────┐
│   PRODUCTS     │         │     ORDERS     │
├────────────────┤         ├────────────────┤
│ • id (PK)      │         │ • id (PK)      │
│ • name         │         │ • user_id (FK) │
│ • price        │         │ • total_amount │
│ • stock_qty    │         │ • status       │
│ • category_id  │◄────┐   │ • delivery_addr│
│ • seller_id    │     │   │ • payment_meth │
│ • image_urls   │     │   └────────┬───────┘
└──┬─────────────┘     │            │
   │                   │            │ 1
   │ 1                 │ N          │
   │                   │            │
   │              ┌────┴────────┐   │ N
   │              │ CATEGORIES  │   │
   │              ├─────────────┤   │
   │              │ • id (PK)   │   │
   │              │ • name      │   │
   │              │ • desc      │   │
   │              └─────────────┘   │
   │                                │
   │ N                              │
   │                                │
┌──▼──────────────────┐    ┌────────▼───────────┐
│    CART_ITEMS       │    │   ORDER_ITEMS      │
├─────────────────────┤    ├────────────────────┤
│ • id (PK)           │    │ • id (PK)          │
│ • user_id (FK)      │    │ • order_id (FK)    │
│ • product_id (FK)   │    │ • product_id (FK)  │
│ • quantity          │    │ • quantity         │
│ • added_at          │    │ • price_at_purchase│
└─────────────────────┘    │ • subtotal         │
                           └────────────────────┘

┌─────────────────────┐
│   WISHLIST_ITEMS    │
├─────────────────────┤
│ • id (PK)           │
│ • user_id (FK)      │
│ • product_id (FK)   │
│ • added_at          │
└─────────────────────┘

┌─────────────────────┐
│      REVIEWS        │
├─────────────────────┤
│ • id (PK)           │
│ • user_id (FK)      │
│ • product_id (FK)   │
│ • rating (1-5)      │
│ • comment           │
│ • created_at        │
└─────────────────────┘

┌─────────────────────┐
│      WALLETS        │
├─────────────────────┤
│ • id (PK)           │
│ • user_id (FK, UQ)  │
│ • balance           │
│ • updated_at        │
└─────────────────────┘
```

**Типы связей:**

1. **Users → Products (1:N)** - один продавец может создать множество товаров
2. **Categories → Products (1:N)** - одна категория содержит множество товаров
3. **Users → Orders (1:N)** - один пользователь может сделать множество заказов
4. **Orders → OrderItems (1:N)** - один заказ содержит множество позиций
5. **Products → OrderItems (1:N)** - один товар может быть в множестве заказов
6. **Users → CartItems (1:N)** - у одного пользователя может быть несколько товаров в корзине
7. **Products → CartItems (1:N)** - один товар может быть в корзинах разных пользователей
8. **Users → WishlistItems (1:N)** - у пользователя может быть несколько товаров в избранном
9. **Products → WishlistItems (1:N)** - товар может быть в избранном у разных пользователей
10. **Users → Reviews (1:N)** - пользователь может оставить множество отзывов
11. **Products → Reviews (1:N)** - у товара может быть множество отзывов
12. **Users → Wallets (1:1)** - у каждого пользователя ровно один кошелек

---

### 2.2.4. Проектирование безопасности данных

Безопасность данных обеспечивается на нескольких уровнях.

#### 1. Защита паролей пользователей

**Проблема:** Хранение паролей в открытом виде опасно - при утечке базы данных злоумышленники получат доступ ко всем аккаунтам.

**Решение:** Хеширование паролей с использованием алгоритма **bcrypt**.

**Принцип работы:**

```
Регистрация пользователя:
1. Пользователь вводит пароль: "MySecurePass123"
2. Сервер применяет bcrypt с salt (случайная строка):
   hashed_password = bcrypt.hash("MySecurePass123" + salt)
   Результат: "$2b$12$KIXxLkR8M9k3fN1pZ7YQW.jE3hP2vR8tL9mK4nQ6w..."
3. В БД сохраняется только хеш, пароль в открытом виде нигде не хранится

Вход в систему:
1. Пользователь вводит пароль: "MySecurePass123"
2. Сервер извлекает хеш из БД для этого email
3. Сервер сравнивает: bcrypt.verify("MySecurePass123", hashed_password_from_db)
4. Если совпадает - доступ разрешен
```

**Преимущества bcrypt:**
- Невозможно обратить хеш в исходный пароль
- Каждый раз хеш разный даже для одинаковых паролей (благодаря salt)
- Специально медленный алгоритм (защита от brute-force атак)

---

#### 2. Защита от SQL-инъекций

**Проблема:** SQL-инъекция - это когда злоумышленник вставляет вредоносный SQL-код через поля ввода.

**Пример атаки:**
```
Пользователь вводит в поле email: admin@shop.com' OR '1'='1
Без защиты SQL-запрос станет:
SELECT * FROM users WHERE email = 'admin@shop.com' OR '1'='1'
Условие '1'='1' всегда истинно → вернутся ВСЕ пользователи!
```

**Решение:** Использование **параметризованных запросов** через SQLAlchemy ORM.

```python
# ОПАСНО (уязвимо к инъекциям):
email = request.data['email']
query = f"SELECT * FROM users WHERE email = '{email}'"
db.execute(query)

# БЕЗОПАСНО (SQLAlchemy экранирует параметры):
email = request.data['email']
user = db.query(User).filter(User.email == email).first()
```

SQLAlchemy автоматически экранирует все специальные символы, делая инъекцию невозможной.

---

#### 3. Защита от XSS (Cross-Site Scripting)

**Проблема:** Злоумышленник может вставить JavaScript-код в поля ввода (например, в описание товара).

**Решение:**
- Backend: Pydantic валидирует типы данных, не позволяя передать HTML-теги
- Frontend: React автоматически экранирует все данные при рендеринге

---

#### 4. Защита API с помощью JWT

**Механизм:**
- Все защищенные endpoints требуют токен в заголовке `Authorization: Bearer <token>`
- Токен проверяется на валидность (срок действия, подпись)
- Извлекается user_id и проверяются права доступа

**Срок действия токена:** 7 дней (после истечения пользователь должен войти заново)

---

#### 5. CORS (Cross-Origin Resource Sharing)

**Проблема:** По умолчанию браузеры запрещают запросы с одного домена на другой.

**Решение:** FastAPI настроен на прием запросов только с `http://localhost:5173` (frontend) в разработке и с рабочего домена в production.

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],  # только этот домен
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
)
```

---

#### 6. Rate Limiting (ограничение частоты запросов)

**Проблема:** Злоумышленник может перегрузить сервер множеством запросов (DDoS-атака) или перебирать пароли.

**Решение:** Ограничение на количество запросов с одного IP-адреса (например, не более 100 запросов в минуту).

---

#### 7. Валидация данных на уровне БД

**Constraints (ограничения) в таблицах:**

```sql
-- Цена не может быть отрицательной
CHECK (price >= 0)

-- Количество на складе не может быть отрицательным
CHECK (stock_quantity >= 0)

-- Рейтинг только от 1 до 5
CHECK (rating >= 1 AND rating <= 5)

-- Email должен быть уникальным
UNIQUE (email)

-- Один товар только один раз в корзине
UNIQUE (user_id, product_id)
```

Эти ограничения не позволят вставить некорректные данные даже при ошибке в коде приложения.

---

## 2.3. Проектирование пользовательского интерфейса (UX/UI)

### 2.3.1. Структура сайта (Sitemap)

Sitemap показывает иерархию всех страниц веб-приложения.

```
ГЛАВНАЯ СТРАНИЦА (/)
│
├── АУТЕНТИФИКАЦИЯ
│   ├── Страница входа (/login)
│   └── Страница регистрации (/register)
│
├── КАТАЛОГ ТОВАРОВ
│   ├── Домашняя страница - список всех товаров (/)
│   ├── Страница товара с деталями (/product/:id)
│   └── Поиск товаров (/search?q=молоко)
│
├── КОРЗИНА И ЗАКАЗЫ (только для авторизованных)
│   ├── Страница корзины (/cart)
│   ├── Страница оформления заказа (/checkout)
│   ├── История заказов (/orders)
│   └── Детали заказа (/order/:id)
│
├── ИЗБРАННОЕ (только для авторизованных)
│   └── Страница избранного (/wishlist)
│
├── ПАНЕЛЬ ПРОДАВЦА (/seller) - только для role=seller
│   ├── Управление товарами (вкладка "Мои товары")
│   ├── Добавление нового товара (модальное окно)
│   ├── Редактирование товара (модальное окно)
│   ├── Заказы с моими товарами (вкладка "Заказы")
│   └── Аналитика продаж (вкладка "Аналитика")
│
├── ПАНЕЛЬ АДМИНИСТРАТОРА (/admin) - только для role=admin
│   ├── Dashboard (главная статистика)
│   ├── Управление пользователями (вкладка "Пользователи")
│   ├── Управление товарами всех продавцов (вкладка "Товары")
│   ├── Управление заказами (вкладка "Заказы")
│   └── Управление категориями (вкладка "Категории")
│
├── ЛИЧНЫЙ КАБИНЕТ
│   └── Профиль пользователя (/profile)
│
└── СЛУЖЕБНЫЕ СТРАНИЦЫ
    └── Страница 404 (не найдено) (/*)
```

---

### 2.3.2. Описание ключевых страниц и компонентов

#### 1. Домашняя страница (HomePage)

**Цель:** Отображение каталога всех товаров с возможностью поиска и фильтрации.

**Структура:**

```
┌──────────────────────────────────────────────────────────────┐
│  HEADER (шапка сайта)                                        │
│  ┌────────────┐  [Поиск товаров...🔍]  🛒(3) ❤️(2) 👤Профиль│
│  │ LOGO       │                                              │
│  │ "Bibarys"  │                                              │
│  └────────────┘                                              │
├──────────────────────────────────────────────────────────────┤
│  НАВИГАЦИЯ                                                   │
│  [Все товары]  [Категории ▼]  [О нас]  [Контакты]          │
├──────────────────────────────────────────────────────────────┤
│  БАННЕР (Hero Section)                                       │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  "Добро пожаловать в Bibarys!"                         │ │
│  │  Широкий выбор качественных продуктов                  │ │
│  │  [Посмотреть каталог →]                                │ │
│  └────────────────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────────────────┤
│  ФИЛЬТРЫ                                                     │
│  Категория: [Все ▼]  Цена: от[___] до[___]  [Применить]   │
├──────────────────────────────────────────────────────────────┤
│  СЕТКА ТОВАРОВ (3-4 колонки)                                │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐           │
│  │[Фото товара]  │[Фото товара]  │[Фото товара]           │
│  │            │  │            │  │            │           │
│  │Молоко 3.2% │  │Хлеб белый  │  │Сыр Гауда   │           │
│  │450 ₸       │  │200 ₸       │  │1500 ₸      │           │
│  │⭐⭐⭐⭐⭐(12)│  │⭐⭐⭐⭐(8)  │  │⭐⭐⭐⭐⭐(5)│           │
│  │[В корзину] │  │[В корзину] │  │[В корзину] │           │
│  │❤️ В избранное│  │❤️ В избранное│  │❤️ В избранное│           │
│  └────────────┘  └────────────┘  └────────────┘           │
│                                                              │
│  [...еще товары...]                                         │
│  [Загрузить еще]                                            │
├──────────────────────────────────────────────────────────────┤
│  FOOTER (подвал сайта)                                       │
│  О компании | Контакты | Политика конфиденциальности       │
│  © 2026 Bibarys. Все права защищены.                        │
└──────────────────────────────────────────────────────────────┘
```

**Функции:**
- Поиск товаров по названию (в реальном времени)
- Фильтрация по категориям и диапазону цен
- Отображение карточек товаров с фото, названием, ценой, рейтингом
- Кнопки "В корзину" и "В избранное"
- Клик на карточку → переход на страницу детал товара

---

#### 2. Страница товара (ProductDetailsPage)

**Цель:** Детальная информация о товаре с возможностью добавления в корзину.

**Структура:**

```
┌────────────────────────────────────────────────────────────┐
│  [← Назад к каталогу]                                      │
├────────────────────────────────────────────────────────────┤
│  ┌───────────────────────┐  ┌──────────────────────────┐  │
│  │  ГАЛЕРЕЯ ИЗОБРАЖЕНИЙ  │  │  ИНФОРМАЦИЯ О ТОВАРЕ     │  │
│  │  ┌─────────────────┐  │  │                          │  │
│  │  │  [Главное фото] │  │  │  Молоко "Веселый         │  │
│  │  │                 │  │  │  молочник" 3.2%          │  │
│  │  │  [   ТОВАР   ]  │  │  │                          │  │
│  │  │                 │  │  │  ⭐⭐⭐⭐⭐ 4.8 (12 отз.)  │  │
│  │  └─────────────────┘  │  │                          │  │
│  │                       │  │  Цена: 450 ₸             │  │
│  │  [📷] [📷] [📷] [📷]  │  │  В наличии: 120 шт.      │  │
│  │  миниатюры            │  │                          │  │
│  └───────────────────────┘  │  Категория: Молочные     │  │
│                             │  Продавец: ИП "Магазин"  │  │
│                             │                          │  │
│                             │  Описание:               │  │
│                             │  Пастеризованное молоко  │  │
│                             │  высшего качества...     │  │
│                             │                          │  │
│                             │  Количество: [-] 1 [+]   │  │
│                             │                          │  │
│                             │  [🛒 Добавить в корзину] │  │
│                             │  [❤️ В избранное]        │  │
│                             └──────────────────────────┘  │
├────────────────────────────────────────────────────────────┤
│  ОТЗЫВЫ (12)                        [⭐⭐⭐⭐⭐ Оставить] │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ Иван Петров  ⭐⭐⭐⭐⭐  02.02.2026                    │ │
│  │ Отличное молоко, свежее!                             │ │
│  └──────────────────────────────────────────────────────┘ │
│  [...еще отзывы...]                                       │
└────────────────────────────────────────────────────────────┘
```

**Функции:**
- Галерея изображений с увеличением по клику
- Отображение рейтинга и количества отзывов
- Выбор количества товара
- Проверка наличия на складе
- Добавление в корзину/избранное
- Просмотр и добавление отзывов

---

#### 3. Страница корзины (CartPage)

**Цель:** Просмотр и редактирование содержимого корзины перед оформлением заказа.

**Структура:**

```
┌────────────────────────────────────────────────────────────┐
│  КОРЗИНА (3 товара)                      [Очистить корзину]│
├────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────┐ │
│  │ [📷]  Молоко 3.2%                 450 ₸              │ │
│  │       Категория: Молочные         Кол-во: [-] 2 [+] │ │
│  │       В наличии: 120 шт.          Итого: 900 ₸      │ │
│  │                                            [🗑️ Удалить]│ │
│  └──────────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ [📷]  Хлеб белый                  200 ₸              │ │
│  │       Категория: Хлебобулочные    Кол-во: [-] 1 [+] │ │
│  │       В наличии: 50 шт.           Итого: 200 ₸      │ │
│  │                                            [🗑️ Удалить]│ │
│  └──────────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ [📷]  Сыр Гауда                   1500 ₸             │ │
│  │       Категория: Молочные         Кол-во: [-] 1 [+] │ │
│  │       В наличии: 30 шт.           Итого: 1500 ₸     │ │
│  │                                            [🗑️ Удалить]│ │
│  └──────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────┤
│  ИТОГО                                                     │
│  ┌──────────────────────────────────────────────────────┐ │
│  │  Товаров: 4 шт.                                      │ │
│  │  Сумма: 2600 ₸                                       │ │
│  │  Доставка: Бесплатно                                 │ │
│  │  ───────────────────────────────────────────────────  │ │
│  │  ИТОГО К ОПЛАТЕ: 2600 ₸                              │ │
│  │                                                       │ │
│  │  [← Продолжить покупки]  [Оформить заказ →]         │ │
│  └──────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

**Функции:**
- Изменение количества товаров (с проверкой остатков)
- Удаление товаров из корзины
- Автоматический пересчет итоговой суммы
- Переход к оформлению заказа

---

#### 4. Страница оформления заказа (CheckoutPage)

**Цель:** Ввод данных доставки и выбор способа оплаты.

**Структура:**

```
┌────────────────────────────────────────────────────────────┐
│  ОФОРМЛЕНИЕ ЗАКАЗА                                         │
│  ┌─────────────┬──────────────────────────────────────────┐│
│  │  Шаг 1 ✓    │  1. ДАННЫЕ ДОСТАВКИ                      ││
│  │  Шаг 2      │                                          ││
│  │  Шаг 3      │  Адрес доставки:                         ││
│  └─────────────┤  [_________________________________]     ││
│                │  г. Астана, ул. Мәңгілік Ел, 55/20      ││
│                │                                          ││
│                │  Телефон:                                ││
│                │  [_________________________________]     ││
│                │  +7 (___) ___-__-__                      ││
│                │                                          ││
│                │  Комментарий к заказу:                   ││
│                │  [_________________________________]     ││
│                │  [_________________________________]     ││
│                │                                          ││
│                │  [Продолжить →]                          ││
│                └──────────────────────────────────────────┘│
│                                                             │
│  ┌─────────────┬──────────────────────────────────────────┐│
│  │  Шаг 1 ✓    │  2. СПОСОБ ОПЛАТЫ                        ││
│  │  Шаг 2 ✓    │                                          ││
│  │  Шаг 3      │  ○ Оплата картой                         ││
│  └─────────────┤  ● Оплата из кошелька (баланс: 5000 ₸)   ││
│                │  ○ Наличными при получении               ││
│                │                                          ││
│                │  [Продолжить →]                          ││
│                └──────────────────────────────────────────┘│
│                                                             │
│  ┌─────────────┬──────────────────────────────────────────┐│
│  │  Шаг 1 ✓    │  3. ПОДТВЕРЖДЕНИЕ                        ││
│  │  Шаг 2 ✓    │                                          ││
│  │  Шаг 3 ✓    │  Ваш заказ:                              ││
│  └─────────────┤  • Молоко 3.2% × 2 = 900 ₸               ││
│                │  • Хлеб белый × 1 = 200 ₸                ││
│                │  • Сыр Гауда × 1 = 1500 ₸                ││
│                │  ──────────────────────                  ││
│                │  Итого: 2600 ₸                           ││
│                │                                          ││
│                │  Адрес: г. Астана, ул. Мәңгілік Ел...    ││
│                │  Телефон: +7 (777) 123-45-67             ││
│                │  Оплата: Кошелек                         ││
│                │                                          ││
│                │  [Подтвердить заказ]                     ││
│                └──────────────────────────────────────────┘│
└────────────────────────────────────────────────────────────┘
```

**Функции:**
- Трехшаговый процесс оформления
- Валидация полей (телефон, адрес)
- Выбор способа оплаты с проверкой баланса
- Итоговое подтверждение с деталями заказа

---

#### 5. Панель продавца (SellerPage)

**Цель:** Управление товарами и просмотр статистики продаж.

**Структура (вкладка "Мои товары"):**

```
┌────────────────────────────────────────────────────────────┐
│  ПАНЕЛЬ ПРОДАВЦА                                 [+ Новый  │
│  [Мои товары] [Заказы] [Аналитика]               товар]   │
├────────────────────────────────────────────────────────────┤
│  Поиск: [___________🔍]  Категория: [Все ▼]              │
├────────────────────────────────────────────────────────────┤
│  МОИ ТОВАРЫ (45)                                           │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ [📷] Молоко 3.2%         Молочные    450 ₸   120 шт. │ │
│  │      ⭐ 4.8 (12)         Активен    [✏️ Изм.] [🗑️ Уд.]│ │
│  └──────────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ [📷] Хлеб белый          Хлебобул.   200 ₸    50 шт. │ │
│  │      ⭐ 4.2 (8)          Активен    [✏️ Изм.] [🗑️ Уд.]│ │
│  └──────────────────────────────────────────────────────┘ │
│  [...еще товары...]                                       │
│  [1] [2] [3] ... [9] пагинация                           │
└────────────────────────────────────────────────────────────┘
```

**Модальное окно "Добавить товар":**

```
┌──────────────────────────────────────────────────────────┐
│  ДОБАВИТЬ ТОВАР                                     [✕]  │
├──────────────────────────────────────────────────────────┤
│  Название: *                                             │
│  [_____________________________________________]         │
│                                                          │
│  Категория: *                                            │
│  [Выберите категорию ▼]                                  │
│                                                          │
│  Цена (₸): *                                             │
│  [____________]                                          │
│                                                          │
│  Количество на складе: *                                 │
│  [____________]                                          │
│                                                          │
│  Описание:                                               │
│  [___________________________________________]           │
│  [___________________________________________]           │
│  [___________________________________________]           │
│                                                          │
│  Фотографии товара (макс. 5):                            │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐          │
│  │ [+]  │ │      │ │      │ │      │ │      │          │
│  │Загр. │ │      │ │      │ │      │ │      │          │
│  └──────┘ └──────┘ └──────┘ └──────┘ └──────┘          │
│                                                          │
│  [Отмена]                            [Добавить товар]   │
└──────────────────────────────────────────────────────────┘
```

**Функции:**
- CRUD операции с товарами
- Загрузка до 5 фотографий товара
- Фильтрация товаров по категориям
- Просмотр статистики (количество товаров, общая стоимость на складе)

---

#### 6. Панель администратора (AdminPage)

**Цель:** Полный контроль над системой.

**Структура (Dashboard):**

```
┌────────────────────────────────────────────────────────────┐
│  ПАНЕЛЬ АДМИНИСТРАТОРА                     👤 Admin        │
│  [Dashboard] [Пользователи] [Товары] [Заказы] [Категории] │
├────────────────────────────────────────────────────────────┤
│  ОБЩАЯ СТАТИСТИКА                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │
│  │ 👥 Пользов.  │ │ 📦 Товаров   │ │ 🛒 Заказов   │      │
│  │    1,234     │ │    567       │ │    890       │      │
│  │    +5 сегодня│ │    +12 новых │ │    +45 новых │      │
│  └──────────────┘ └──────────────┘ └──────────────┘      │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │
│  │ 💰 Выручка   │ │ 📊 Ср. чек   │ │ ⏳ На обр-ке │      │
│  │  1,245,670 ₸ │ │    1,400 ₸   │ │     23       │      │
│  │  +15% за мес.│ │    +5% за нед│ │              │      │
│  └──────────────┘ └──────────────┘ └──────────────┘      │
├────────────────────────────────────────────────────────────┤
│  ГРАФИК ПРОДАЖ (за последние 7 дней)                      │
│  ┌──────────────────────────────────────────────────────┐ │
│  │                                  ▄▄                  │ │
│  │                         ▄▄      ████                 │ │
│  │                ▄▄      ████    ██████                │ │
│  │       ▄▄      ████    ██████  ████████               │ │
│  │ ▄▄   ████    ██████  ████████████████▄▄              │ │
│  │████ ██████  ████████████████████████████             │ │
│  ├──────────────────────────────────────────────────────┤ │
│  │Пн   Вт   Ср   Чт   Пт   Сб   Вс                     │ │
│  └──────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────┤
│  ПОСЛЕДНИЕ ЗАКАЗЫ                            [Все заказы→]│
│  ┌──────────────────────────────────────────────────────┐ │
│  │ #1234  Иван Петров   3 товара   2,600 ₸   Pending   │ │
│  │ #1233  Мария Иванова 5 товаров  4,500 ₸   Processing│ │
│  │ #1232  Петр Сидоров  2 товара   1,200 ₸   Completed │ │
│  └──────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

**Функции:**
- Визуализация ключевых метрик
- Графики продаж
- Быстрый доступ к последним заказам
- Навигация по всем разделам управления

---

### 2.3.3. Принципы проектирования UI/UX

#### 1. Консистентность (Единообразие)

- Одинаковые элементы выглядят и работают одинаково во всех частях приложения
- Единая цветовая схема (градиенты серого для фона, primary цвет для кнопок)
- Единые отступы и размеры элементов (Tailwind CSS обеспечивает)

#### 2. Адаптивность (Responsive Design)

- Интерфейс адаптируется под разные размеры экранов
- На мобильных: 1 колонка товаров, на планшетах: 2, на десктопах: 3-4
- Навигация на мобильных превращается в бургер-меню

#### 3. Обратная связь

- При каждом действии пользователь получает уведомление
- "Товар добавлен в корзину" ✅
- "Ошибка: недостаточно товара на складе" ❌
- Анимации при наведении на кнопки

#### 4. Минимализм

- Только необходимая информация на экране
- Отсутствие перегруженности
- Белое пространство для визуального разделения блоков

#### 5. Доступность (Accessibility)

- Достаточный контраст текста и фона
- Подписи к иконкам
- Возможность навигации с клавиатуры

---

**Выводы по проектной части:**

1. Спроектирована трехуровневая клиент-серверная архитектура с разделением на frontend, backend и базу данных.

2. Разработана структура REST API с 59 endpoints, разделенными на 13 функциональных модулей.

3. Спроектирована реляционная база данных из 9 таблиц с установленными связями и ограничениями целостности.

4. Реализованы меры безопасности данных: хеширование паролей (bcrypt), защита от SQL-инъекций (SQLAlchemy ORM), JWT-аутентификация, валидация на уровне БД.

5. Спроектирован пользовательский интерфейс с тремя панелями (покупатель, продавец, администратор), обеспечивающий удобное взаимодействие с системой.

6. Разработана sitemap и описаны макеты ключевых страниц приложения с соблюдением принципов UX/UI дизайна.
