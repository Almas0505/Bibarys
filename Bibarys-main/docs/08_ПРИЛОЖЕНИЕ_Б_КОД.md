# ПРИЛОЖЕНИЕ Б

## СПИСОК ОСНОВНЫХ ФАЙЛОВ КОДА ПРИЛОЖЕНИЯ

---

### BACKEND (Python/FastAPI)

#### 1. Конфигурация и запуск

**Файл:** `backend/app/main.py` (50 строк)
```
Главный файл приложения FastAPI.
Содержит:
- Инициализацию приложения FastAPI
- Настройку CORS middleware
- Подключение роутеров API
- Событие startup для создания таблиц БД
- Корневой endpoint /
```

**Файл:** `backend/app/config.py` (35 строк)
```
Конфигурация приложения.
Содержит:
- Класс Settings с параметрами из .env
- DATABASE_URL, SECRET_KEY, ALGORITHM
- API_V1_PREFIX
```

**Файл:** `backend/run.py` (10 строк)
```
Скрипт запуска сервера разработки.
Запускает uvicorn с auto-reload.
```

---

#### 2. Модели базы данных

**Файл:** `backend/app/db/base.py` (15 строк)
```
Базовый класс для моделей.
Содержит:
- declarative_base() от SQLAlchemy
- Base класс для наследования
```

**Файл:** `backend/app/db/session.py` (25 строк)
```
Конфигурация сессий БД.
Содержит:
- Создание engine
- SessionLocal фабрика
- get_db() dependency
```

**Файл:** `backend/app/db/models.py` (450 строк)
```
Определение всех моделей БД.
Содержит 9 моделей:
- User (пользователи)
- Category (категории)
- Product (товары)
- Order (заказы)
- OrderItem (позиции заказов)
- CartItem (корзина)
- WishlistItem (избранное)
- Review (отзывы)
- Wallet (кошельки)
```

---

#### 3. Схемы валидации (Pydantic)

**Файл:** `backend/app/schemas/user.py` (80 строк)
```
Схемы для пользователей.
Содержит:
- UserCreate (регистрация)
- UserUpdate (обновление профиля)
- UserResponse (ответ API)
- UserInDB (с паролем)
```

**Файл:** `backend/app/schemas/product.py` (100 строк)
```
Схемы для товаров.
Содержит:
- ProductCreate (создание товара)
- ProductUpdate (обновление)
- ProductResponse (ответ с категорией и продавцом)
- ProductSearch (параметры поиска)
```

**Файл:** `backend/app/schemas/order.py` (90 строк)
```
Схемы для заказов.
Содержит:
- OrderCreate (создание заказа)
- OrderUpdate (обновление статуса)
- OrderResponse (с позициями и пользователем)
- OrderItemResponse (позиция заказа)
- OrderUserInfo (информация о покупателе)
```

**Файл:** `backend/app/schemas/common.py` (40 строк)
```
Общие схемы.
Содержит:
- SuccessResponse
- ErrorResponse
- PaginationParams
```

---

#### 4. API endpoints

**Файл:** `backend/app/api/v1/auth.py` (120 строк)
```
Аутентификация пользователей.
Endpoints:
- POST /register (регистрация)
- POST /login (вход)
- GET /me (текущий пользователь)
- PUT /me (обновление профиля)
```

**Файл:** `backend/app/api/v1/users.py` (150 строк)
```
Управление пользователями (админ).
Endpoints:
- GET / (список пользователей)
- GET /{user_id} (один пользователь)
- POST /{user_id}/change-role (изменение роли)
- POST /{user_id}/toggle-active (блокировка)
- DELETE /{user_id} (удаление)
- GET /stats (статистика)
```

**Файл:** `backend/app/api/v1/products.py` (200 строк)
```
Управление товарами.
Endpoints:
- GET / (список товаров с фильтрацией)
- GET /{product_id} (один товар)
- POST / (создание товара)
- PUT /{product_id} (обновление)
- DELETE /{product_id} (удаление)
- GET /seller/my (товары продавца)
- GET /category/{category_id} (по категории)
- POST /search (поиск)
```

**Файл:** `backend/app/api/v1/categories.py` (100 строк)
```
Управление категориями.
Endpoints:
- GET / (список категорий)
- GET /{category_id} (одна категория)
- POST / (создание, админ)
- PUT /{category_id} (обновление, админ)
- DELETE /{category_id} (удаление, админ)
```

**Файл:** `backend/app/api/v1/cart.py` (120 строк)
```
Корзина покупок.
Endpoints:
- GET / (корзина пользователя)
- POST /add (добавить товар)
- PUT /update/{item_id} (изменить количество)
- DELETE /remove/{item_id} (удалить товар)
- DELETE /clear (очистить корзину)
```

**Файл:** `backend/app/api/v1/orders.py` (250 строк)
```
Управление заказами.
Endpoints:
- GET / (все заказы, админ)
- GET /my (заказы пользователя)
- GET /{order_id} (один заказ)
- POST /create (создание заказа)
- PUT /{order_id}/status (обновление статуса)
- DELETE /{order_id} (отмена заказа)
- GET /seller/my (заказы продавца)
- GET /stats (статистика)
- POST /export-pdf (экспорт в PDF)
```

**Файл:** `backend/app/api/v1/reviews.py` (100 строк)
```
Отзывы на товары.
Endpoints:
- GET /product/{product_id} (отзывы товара)
- POST /product/{product_id} (добавить отзыв)
- PUT /{review_id} (редактировать)
- DELETE /{review_id} (удалить)
- GET /my (мои отзывы)
```

**Файл:** `backend/app/api/v1/wishlist.py` (80 строк)
```
Список избранного.
Endpoints:
- GET / (избранное пользователя)
- POST /add (добавить товар)
- DELETE /remove/{product_id} (удалить)
- POST /move-to-cart/{product_id} (в корзину)
```

**Файл:** `backend/app/api/v1/wallet.py` (90 строк)
```
Управление кошельком.
Endpoints:
- GET / (баланс)
- POST /deposit (пополнение)
- GET /transactions (история)
- POST /withdraw (вывод)
```

**Файл:** `backend/app/api/v1/analytics.py` (120 строк)
```
Аналитика и статистика.
Endpoints:
- GET /dashboard (общая статистика)
- GET /sales-chart (график продаж)
- GET /top-products (топ товары)
- GET /revenue-stats (финансовая статистика)
```

**Файл:** `backend/app/api/v1/uploads.py` (70 строк)
```
Загрузка файлов.
Endpoints:
- POST /image (загрузка изображения)
- DELETE /image/{filename} (удаление)
```

---

#### 5. Сервисы (бизнес-логика)

**Файл:** `backend/app/services/user_service.py` (150 строк)
```
Сервис пользователей.
Функции:
- create_user() (создание с хешированием пароля)
- get_user_by_email() (поиск по email)
- update_user() (обновление профиля)
- change_user_role() (изменение роли)
- toggle_user_active() (блокировка)
```

**Файл:** `backend/app/services/product_service.py` (200 строк)
```
Сервис товаров.
Функции:
- create_product() (создание товара)
- get_products() (список с фильтрацией)
- update_product() (обновление)
- delete_product() (удаление с проверкой)
- search_products() (поиск)
```

**Файл:** `backend/app/services/order_service.py` (300 строк)
```
Сервис заказов.
Функции:
- create_order_from_cart() (создание из корзины)
- update_order_status() (изменение статуса)
- cancel_order() (отмена с возвратом товаров)
- get_user_orders() (заказы пользователя)
- calculate_order_total() (расчет суммы)
```

**Файл:** `backend/app/services/pdf_service.py` (250 строк)
```
Генерация PDF-отчетов.
Функции:
- generate_sales_report() (отчет о продажах)
- generate_products_report() (список товаров)
- generate_order_details() (детали заказа)
Использует ReportLab для создания PDF.
```

**Файл:** `backend/app/services/email_service.py` (80 строк)
```
Отправка email-уведомлений (опционально).
Функции:
- send_order_confirmation() (подтверждение заказа)
- send_password_reset() (восстановление пароля)
```

---

#### 6. Безопасность

**Файл:** `backend/app/core/security.py` (120 строк)
```
Функции безопасности.
Содержит:
- hash_password() (bcrypt хеширование)
- verify_password() (проверка пароля)
- create_access_token() (генерация JWT)
- decode_access_token() (валидация JWT)
- get_current_user() (dependency для endpoints)
- require_role() (проверка роли)
```

**Файл:** `backend/app/core/exceptions.py` (50 строк)
```
Кастомные исключения.
Классы:
- NotFoundException
- ForbiddenException
- UnauthorizedException
- ValidationException
```

**Файл:** `backend/app/core/storage.py` (100 строк)
```
Работа с файловым хранилищем.
Функции:
- save_uploaded_file() (сохранение файла)
- delete_file() (удаление)
- resize_image() (изменение размера)
- generate_unique_filename() (UUID имя)
```

---

### FRONTEND (React/TypeScript)

#### 7. Точка входа и конфигурация

**Файл:** `frontend/src/main.tsx` (30 строк)
```
Точка входа приложения.
Содержит:
- ReactDOM.createRoot()
- Обертка Redux Provider
- Обертка React Router
```

**Файл:** `frontend/src/App.tsx` (120 строк)
```
Главный компонент приложения.
Содержит:
- Роутинг всех страниц
- Обертка Layout (Header + Footer)
- Protected routes для авторизованных
```

**Файл:** `frontend/vite.config.ts` (25 строк)
```
Конфигурация Vite.
Настройки:
- Плагины (React)
- Алиасы путей (@/)
- Proxy для API (опционально)
```

**Файл:** `frontend/tailwind.config.js` (40 строк)
```
Конфигурация Tailwind CSS.
Настройки:
- Цветовая палитра (primary, secondary)
- Кастомные breakpoints
- Расширения (animations, gradients)
```

---

#### 8. Типы TypeScript

**Файл:** `frontend/src/types/user.ts` (50 строк)
```
Типы пользователей.
Интерфейсы:
- User (основной тип)
- UserRole (enum)
- LoginCredentials
- RegisterData
```

**Файл:** `frontend/src/types/product.ts` (70 строк)
```
Типы товаров.
Интерфейсы:
- Product (основной тип)
- ProductCreate
- ProductFilter
- Category
```

**Файл:** `frontend/src/types/order.ts` (80 строк)
```
Типы заказов.
Интерфейсы:
- Order (основной тип)
- OrderItem (позиция заказа)
- OrderStatus (enum)
- CheckoutData
```

---

#### 9. Redux Store

**Файл:** `frontend/src/store/index.ts` (30 строк)
```
Конфигурация Redux Store.
Содержит:
- configureStore() с reducers
- Экспорт RootState и AppDispatch
```

**Файл:** `frontend/src/store/slices/authSlice.ts` (150 строк)
```
Redux slice для аутентификации.
Содержит:
- State (user, token, loading, error)
- Async thunks (login, register, logout)
- Reducers (setUser, clearAuth)
```

**Файл:** `frontend/src/store/slices/productSlice.ts` (200 строк)
```
Redux slice для товаров.
Содержит:
- State (products, currentProduct, loading)
- Async thunks (fetchProducts, fetchProductById)
- Reducers (setProducts, clearCurrentProduct)
```

**Файл:** `frontend/src/store/slices/cartSlice.ts` (180 строк)
```
Redux slice для корзины.
Содержит:
- State (items, total, loading)
- Async thunks (addToCart, updateQuantity, removeItem)
- Reducers (calculateTotal)
```

**Файл:** `frontend/src/store/slices/orderSlice.ts` (150 строк)
```
Redux slice для заказов.
Содержит:
- State (orders, currentOrder, loading)
- Async thunks (createOrder, fetchOrders, updateStatus)
```

**Файл:** `frontend/src/store/slices/wishlistSlice.ts` (100 строк)
```
Redux slice для избранного.
Содержит:
- State (items, loading)
- Async thunks (addToWishlist, removeFromWishlist)
```

---

#### 10. API сервисы

**Файл:** `frontend/src/services/api.ts` (60 строк)
```
Базовая конфигурация Axios.
Содержит:
- Создание axios instance
- Request interceptor (добавление JWT)
- Response interceptor (обработка ошибок)
```

**Файл:** `frontend/src/services/authService.ts` (70 строк)
```
Сервис аутентификации.
Функции:
- login() (вход)
- register() (регистрация)
- logout() (выход)
- getCurrentUser() (получение профиля)
```

**Файл:** `frontend/src/services/productService.ts` (120 строк)
```
Сервис товаров.
Функции:
- getProducts() (список)
- getProductById() (один товар)
- createProduct() (создание)
- updateProduct() (обновление)
- deleteProduct() (удаление)
- searchProducts() (поиск)
```

**Файл:** `frontend/src/services/orderService.ts` (100 строк)
```
Сервис заказов.
Функции:
- createOrder() (создание)
- getOrders() (список)
- getOrderById() (один заказ)
- updateOrderStatus() (обновление статуса)
- cancelOrder() (отмена)
```

**Файл:** `frontend/src/services/cartService.ts` (80 строк)
```
Сервис корзины.
Функции:
- getCart() (получить корзину)
- addToCart() (добавить товар)
- updateQuantity() (изменить количество)
- removeItem() (удалить)
- clearCart() (очистить)
```

---

#### 11. Компоненты

**Файл:** `frontend/src/components/layout/Header.tsx` (150 строк)
```
Шапка сайта.
Содержит:
- Логотип
- Поиск товаров
- Навигационное меню
- Иконки корзины и избранного
- Профиль пользователя
```

**Файл:** `frontend/src/components/layout/Footer.tsx` (140 строк)
```
Подвал сайта.
Содержит:
- Информация о компании
- Ссылки на разделы
- Социальные сети
- Контакты
- Copyright
```

**Файл:** `frontend/src/components/common/ProductCard.tsx` (120 строк)
```
Карточка товара.
Props: product
Содержит:
- Изображение товара
- Название, цена, рейтинг
- Кнопки "В корзину", "В избранное"
```

**Файл:** `frontend/src/components/common/Button.tsx` (50 строк)
```
Переиспользуемая кнопка.
Props: variant, size, disabled, onClick
Варианты: primary, secondary, danger
```

**Файл:** `frontend/src/components/common/Input.tsx` (60 строк)
```
Переиспользуемое поле ввода.
Props: type, placeholder, value, onChange, error
Поддержка валидации и ошибок.
```

**Файл:** `frontend/src/components/common/Spinner.tsx` (30 строк)
```
Индикатор загрузки.
Props: size (small, medium, large)
```

**Файл:** `frontend/src/components/auth/LoginForm.tsx` (150 строк)
```
Форма входа.
Содержит:
- Поля email и password
- Валидация формы
- Обработка ошибок
- Ссылка на регистрацию
```

**Файл:** `frontend/src/components/auth/RegisterForm.tsx` (200 строк)
```
Форма регистрации.
Содержит:
- Поля: email, имя, фамилия, пароль, подтверждение
- Валидация (email format, длина пароля)
- Обработка ошибок
```

**Файл:** `frontend/src/components/checkout/CheckoutForm.tsx` (300 строк)
```
Форма оформления заказа.
Содержит:
- 3 шага (адрес, оплата, подтверждение)
- Валидация полей
- Расчет итоговой суммы
- Отправка заказа
```

**Файл:** `frontend/src/components/seller/ProductForm.tsx` (250 строк)
```
Форма добавления/редактирования товара.
Содержит:
- Поля: название, описание, цена, количество, категория
- Загрузка фотографий
- Валидация
```

**Файл:** `frontend/src/components/seller/PhotoUpload.tsx` (180 строк)
```
Компонент загрузки фотографий.
Содержит:
- Drag & drop
- Предпросмотр изображений
- Удаление фото
- Ограничение (макс. 5 фото)
```

**Файл:** `frontend/src/components/admin/AdminDashboard.tsx` (300 строк)
```
Dashboard администратора.
Содержит:
- Карточки статистики
- График продаж
- Список последних заказов
- Навигация по разделам
```

**Файл:** `frontend/src/components/admin/UsersManagement.tsx` (350 строк)
```
Управление пользователями.
Содержит:
- Таблица пользователей
- Фильтры (роль, статус)
- Поиск по email/имени
- Действия (изменить роль, заблокировать, удалить)
```

**Файл:** `frontend/src/components/admin/OrdersManagement.tsx` (400 строк)
```
Управление заказами.
Содержит:
- Таблица заказов
- Фильтры (статус, дата)
- Поиск по номеру/email
- Изменение статуса
- Детальный просмотр заказа
```

---

#### 12. Страницы

**Файл:** `frontend/src/pages/HomePage.tsx` (200 строк)
```
Главная страница (каталог товаров).
Содержит:
- Баннер
- Фильтры (категория, цена)
- Сетка товаров (ProductCard)
- Пагинация
```

**Файл:** `frontend/src/pages/ProductDetailsPage.tsx` (250 строк)
```
Страница детального просмотра товара.
Содержит:
- Галерея изображений
- Информация о товаре
- Выбор количества
- Кнопки действий
- Раздел отзывов
```

**Файл:** `frontend/src/pages/CartPage.tsx` (200 строк)
```
Страница корзины.
Содержит:
- Список товаров в корзине
- Изменение количества
- Удаление товаров
- Блок "Итого"
- Кнопка "Оформить заказ"
```

**Файл:** `frontend/src/pages/CheckoutPage.tsx` (300 строк)
```
Страница оформления заказа.
Содержит:
- CheckoutForm компонент
- Индикатор шагов
- Обработка успешного создания
```

**Файл:** `frontend/src/pages/OrdersPage.tsx` (250 строк)
```
История заказов пользователя.
Содержит:
- Список заказов
- Фильтры по статусу
- Детальная информация
- Отслеживание статуса
```

**Файл:** `frontend/src/pages/WishlistPage.tsx` (150 строк)
```
Страница избранного.
Содержит:
- Сетка избранных товаров
- Кнопка "В корзину"
- Удаление из избранного
```

**Файл:** `frontend/src/pages/SellerPage.tsx` (400 строк)
```
Панель продавца.
Содержит:
- Вкладки (Товары, Заказы, Аналитика)
- Таблица товаров продавца
- ProductForm для добавления
- Статистика продаж
```

**Файл:** `frontend/src/pages/AdminPage.tsx` (500 строк)
```
Панель администратора.
Содержит:
- Вкладки (Dashboard, Пользователи, Товары, Заказы, Категории)
- Компоненты управления
- Статистика и аналитика
```

**Файл:** `frontend/src/pages/LoginPage.tsx` (100 строк)
```
Страница входа.
Содержит:
- LoginForm компонент
- Ссылка на регистрацию
```

**Файл:** `frontend/src/pages/RegisterPage.tsx` (100 строк)
```
Страница регистрации.
Содержит:
- RegisterForm компонент
- Ссылка на вход
```

**Файл:** `frontend/src/pages/NotFoundPage.tsx` (50 строк)
```
Страница 404.
Содержит:
- Сообщение "Страница не найдена"
- Кнопка возврата на главную
```

---

#### 13. Утилиты и хелперы

**Файл:** `frontend/src/utils/helpers.ts` (100 строк)
```
Вспомогательные функции.
Функции:
- formatPrice() (форматирование цены)
- formatDate() (форматирование даты)
- getImageUrl() (полный URL изображения)
- truncateText() (обрезка текста)
```

**Файл:** `frontend/src/utils/validation.ts` (80 строк)
```
Валидация данных.
Функции:
- validateEmail() (проверка email)
- validatePassword() (проверка пароля)
- validatePhone() (проверка телефона)
```

**Файл:** `frontend/src/hooks/redux.ts` (15 строк)
```
Типизированные хуки Redux.
Экспорт:
- useAppDispatch() (типизированный dispatch)
- useAppSelector() (типизированный selector)
```

---

### КОНФИГУРАЦИЯ И РАЗВЕРТЫВАНИЕ

#### 14. Docker и Nginx

**Файл:** `backend/Dockerfile` (30 строк)
```
Dockerfile для backend.
Шаги:
- Базовый образ Python 3.11
- Установка зависимостей
- Копирование кода
- CMD uvicorn
```

**Файл:** `docker-compose.yml` (80 строк)
```
Оркестрация контейнеров.
Сервисы:
- backend (FastAPI)
- frontend (Nginx + React build)
- db (PostgreSQL)
```

**Файл:** `nginx/nginx.conf` (60 строк)
```
Конфигурация Nginx.
Настройки:
- Раздача статики frontend
- Проксирование API на backend
- GZIP сжатие
- Cache headers
```

---

#### 15. Зависимости

**Файл:** `backend/requirements.txt` (25 строк)
```
Зависимости Python.
Основные:
- fastapi==0.109.0
- uvicorn==0.25.0
- sqlalchemy==2.0.25
- pydantic==2.5.3
- python-jose[cryptography]==3.3.0
- passlib[bcrypt]==1.7.4
- pillow==10.2.0
- reportlab==4.0.9
- python-multipart==0.0.6
```

**Файл:** `frontend/package.json` (40 строк)
```
Зависимости Node.js.
Основные:
- react: ^18.2.0
- react-dom: ^18.2.0
- typescript: ^5.2.2
- vite: ^5.0.8
- @reduxjs/toolkit: ^2.0.1
- react-router-dom: ^6.21.1
- axios: ^1.6.5
- tailwindcss: ^3.4.1
- lucide-react: ^0.307.0
- react-hot-toast: ^2.4.1
```

---

### СТАТИСТИКА ПРОЕКТА

**Backend:**
- Количество файлов: ~45
- Строк кода Python: ~8,500
- Количество моделей: 9
- Количество API endpoints: 59
- Количество тестов: 15

**Frontend:**
- Количество файлов: ~65
- Строк кода TypeScript/TSX: ~12,000
- Количество компонентов: 64
- Количество страниц: 10
- Количество Redux slices: 5

**Общая статистика:**
- Всего файлов кода: ~110
- Всего строк кода: ~20,500
- Технологий использовано: 25+
- Продолжительность разработки: 3 месяца
- Размер кодовой базы: ~2.5 МБ (без node_modules и venv)

---

**Примечание:** Указанные количества строк являются приблизительными и включают только основной код без комментариев и пустых строк.
