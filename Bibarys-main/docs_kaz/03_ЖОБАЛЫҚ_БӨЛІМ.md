# 2-БӨЛІМ. ЖҮЙЕНІ ЖОБАЛАУ

## 2.1. Жүйе архитектурасын әзірлеу

### 2.1.1. Веб-қосымшаның жалпы архитектурасы

Әзірленген веб-қосымша **үш деңгейлі клиент-сервер архитектурасы** негізінде құрылған, бұл жүйе компоненттері арасындағы жауапкершілікті бөлуді қамтамасыз етеді және масштабтауды мен қолдауды жеңілдетеді.

**Архитектура деңгейлері:**

```
┌─────────────────────────────────────────────────────────────┐
│                      1-ДЕҢГЕЙ: КЛИЕНТ                       │
│                     (Presentation Layer)                    │
├─────────────────────────────────────────────────────────────┤
│  • Пайдаланушы веб-браузері (Chrome, Firefox, Safari)      │
│  • React-қосымшасы (Single Page Application)               │
│  • Бейімделген интерфейс (мобильді, планшет, десктоп)     │
│  • Redux Store күйді басқару үшін                          │
└─────────────────────────────────────────────────────────────┘
                            ↕ HTTP/HTTPS
                         (REST API)
┌─────────────────────────────────────────────────────────────┐
│                   2-ДЕҢГЕЙ: ҚОСЫМША СЕРВЕРІ                 │
│                     (Application Layer)                     │
├─────────────────────────────────────────────────────────────┤
│  • FastAPI (бизнес-логика және сұраныстарды өңдеу)         │
│  • JWT-аутентификация және авторизация                     │
│  • Деректерді тексеру (Pydantic)                           │
│  • Бизнес-сервистер (UserService, ProductService, т.б.)   │
│  • Файлдарды өңдеу (тауар суреттері)                       │
│  • PDF-есептерін жасау                                     │
│  • WebSocket нақты уақыттағы хабарламалар үшін             │
└─────────────────────────────────────────────────────────────┘
                            ↕ SQL
                        (SQLAlchemy)
┌─────────────────────────────────────────────────────────────┐
│                   3-ДЕҢГЕЙ: ДЕРЕКҚОР                        │
│                       (Data Layer)                          │
├─────────────────────────────────────────────────────────────┤
│  • PostgreSQL (production) / SQLite (development)          │
│  • Пайдаланушылар, тауарлар, тапсырыстар деректерін сақтау │
│  • Деректер тұтастығын қамтамасыз ету (constraints, triggers)│
│  • Сұраныстарды оңтайландыру үшін индекстер                │
└─────────────────────────────────────────────────────────────┘
```

---

### 2.1.2. Жүйе компоненттерінің өзара әрекеттесуі

**Жүйенің жұмысының үлгілік сценарийі (себетке тауар қосу мысалында):**

1. **Пайдаланушы әрекеті**
   - Пайдаланушы веб-браузерді ашып, `http://localhost:5173` сайтына өтеді
   - Браузер React-қосымшасын жүктейді (HTML, CSS, JavaScript)
   - Пайдаланушы тауарлар каталогын қарап, "Себетке қосу" батырмасын басады

2. **Клиентте өңдеу (Frontend)**
   - React-компоненті `ProductCard` басу оқиғасын қармайды
   - Redux Action `addToCart()` Store-ға жіберіледі
   - Axios серверге HTTP POST сұранысын жібереді:
     ```
     POST http://localhost:8000/api/v1/cart/add
     Headers: Authorization: Bearer <JWT_TOKEN>
     Body: { "product_id": 123, "quantity": 1 }
     ```

3. **Серверде өңдеу (Backend)**
   - Nginx (production-да) немесе Uvicorn сұранысты қабылдайды
   - FastAPI сұранысты `/api/v1/cart/add` endpoint-ке бағыттайды
   - Middleware JWT-токенді тексереді және пайдаланушы ID-ін алады
   - Pydantic сұраныс деректерін тексереді (product_id - сан, quantity > 0)
   - CartService бизнес-логиканы орындайды:
     - Тауардың қоймада бар-жоғын тексереді
     - Тауардың себетте бұрыннан бар-жоғын тексереді (санын жаңарту)
     - Дерекқорда жазба жасау әдісін шақырады

4. **Дерекқормен жұмыс**
   - SQLAlchemy ORM SQL-сұранысын құрайды:
     ```sql
     INSERT INTO cart_items (user_id, product_id, quantity)
     VALUES (42, 123, 1)
     ON CONFLICT (user_id, product_id) 
     DO UPDATE SET quantity = cart_items.quantity + 1
     ```
   - PostgreSQL сұранысты орындайды және нәтижені қайтарады
   - Транзакция бекітіледі (COMMIT)

5. **Клиентке жауапты қайтару**
   - FastAPI JSON-жауабын құрайды:
     ```json
     {
       "success": true,
       "message": "Тауар себетке қосылды",
       "cart_items_count": 3
     }
     ```
   - HTTP Response 200 OK браузерге қайтарылады

6. **Интерфейсті жаңарту**
   - Axios жауапты алады және Redux Store-ды жаңартады
   - React re-render себет белгішесін жаңартады ("3 тауар" көрсетеді)
   - Toast-хабарлама "Тауар себетке қосылды" көрсетіледі

---

### 2.1.3. Жүйенің функционалдық модульдері

Веб-қосымша пайдаланушы рөлдеріне қарай үш негізгі функционалдық модульге бөлінген.

---

#### 1-модуль: Сатып алушы панелі (Customer Module)

**Мақсаты:** Дүкеннің қарапайым сатып алушылары үшін функцияларды қамтамасыз ету.

**Негізгі компоненттер:**

1. **Тауарлар каталогы модулі**
   - Санаттар бойынша сүзгілеумен барлық қолжетімді тауарларды қарау
   - Тауарларды атауы бойынша іздеу
   - Тауар туралы толық ақпарат (фото, баға, сипаттама, қолжетімділік)
   - Пікірлер және рейтингтер жүйесі

2. **Сатып алу себеті модулі**
   - Тауарларды қосу/жою
   - Тауар бірліктерінің санын өзгерту
   - Жалпы құнды автоматты есептеу
   - Барлық себетті тазалау

3. **Таңдаулылар модулі (Wishlist)**
   - Ұнаған тауарларды тілектер тізіміне қосу
   - Тауарларды таңдаулылардан себетке жылдам көшіру
   - Таңдаулылар тізімін басқару

4. **Тапсырысты рәсімдеу модулі (Checkout)**
   - Жеткізу деректерін енгізу (мекенжай, телефон)
   - Төлем әдісін таңдау
   - Тапсырысты растау
   - Сәтті жасалғаны туралы хабарлама алу

5. **Тапсырыстар тарихы модулі**
   - Барлық рәсімделген тапсырыстарды қарау
   - Әрбір тапсырыс туралы толық ақпарат (құрамы, мәртебесі, сомасы)
   - Орындалу мәртебесін қадағалау

6. **Жеке кабинет модулі**
   - Профильді қарау және өңдеу
   - Құпия сөзді өзгерту
   - Жеткізу мекенжайларын басқару

**Технологиялар:**
- React компоненттері: `HomePage`, `ProductDetailsPage`, `CartPage`, `CheckoutPage`, `OrdersPage`
- Redux slices: `authSlice`, `cartSlice`, `wishlistSlice`, `orderSlice`

---

#### 2-модуль: Сатушы панелі (Seller Module)

**Мақсаты:** Тауарларды басқару және сатылымдарды қадағалау құралдары.

**Негізгі компоненттер:**

1. **Тауарларды басқару модулі**
   - Жаңа тауарлар жасау (атауы, сипаттамасы, бағасы, санаты, саны)
   - Тауар фотосуреттерін жүктеу (тауар басына 5 суретке дейін)
   - Тауарлар туралы ақпаратты өңдеу
   - Тауарларды жою (тапсырыстарда бар-жоғын тексерумен)
   - Қоймадағы қалдықтарды басқару

2. **Санаттар модулі**
   - Тауарлардың жаңа санаттарын жасау
   - Санаттарды өңдеу және жою
   - Әрбір санаттағы тауарларды қарау

3. **Тапсырыстарды қарау модулі**
   - Сатушының тауарлары бар барлық тапсырыстар тізімі
   - Тапсырыстарды мәртебе бойынша сүзгілеу (жаңа, өңделуде, орындалған)
   - Тапсырыс туралы толық ақпарат (сатып алушы, тауарлар, сома)

4. **Сатылымдар аналитикасы модулі**
   - Күндер/апталар/айлар бойынша сатылым графигі
   - Ең көп сатылған 5 тауар
   - Жалпы кіріс және тапсырыстар саны
   - Орташа чек

5. **Пікірлер модулі**
   - Сатушының тауарларына сатып алушылардың пікірлерін қарау
   - Пікірлерге жауап беру
   - Теріс пікірлерді модерациялау

**Технологиялар:**
- React компоненттері: `SellerPage`, `ProductForm`, `PhotoUpload`, `SellerAnalytics`
- Services: `ProductService`, `OrderService`, `ReviewService`

---

#### 3-модуль: Әкімші панелі (Admin Module)

**Мақсаты:** Жүйе мен бизнес-процестерді толық бақылау.

**Негізгі компоненттер:**

1. **Әкімшілік панелі (Dashboard)**
   - Жалпы статистика: пайдаланушылар, тауарлар, тапсырыстар саны
   - Жалпы кіріс және орташа чек
   - Соңғы 7 күндегі сатылым графигі
   - Соңғы 5 тапсырыс тізімі жылдам қарауымен

2. **Пайдаланушыларды басқару модулі**
   - Барлық пайдаланушылар тізімін қарау (сатып алушылар, сатушылар, әкімшілер)
   - Пайдаланушыларды email немесе аты бойынша іздеу
   - Рөлдер бойынша сүзгілеу (customer, seller, admin)
   - Пайдаланушы рөлін өзгерту
   - Есеп жазбаларын блоктау/блоктан шығару
   - Пайдаланушыларды жою

3. **Тауарларды басқару модулі**
   - Жүйедегі барлық тауарларды қарау (барлық сатушылардан)
   - Кез келген тауарды өңдеу және жою
   - Жариялаудан бұрын жаңа тауарларды модерациялау (қосымша)
   - Бағаларды немесе санаттарды жаппай өзгерту

4. **Тапсырыстарды басқару модулі**
   - Жүйедегі барлық тапсырыстардың толық тізімі
   - Тапсырыстарды ID, сатып алушы email немесе күні бойынша іздеу
   - Мәртебе бойынша сүзгілеу (pending, processing, completed, cancelled)
   - Тапсырыс мәртебесін өзгерту
   - Проблемалы тапсырыстарды болдырмау
   - Тапсырыс деталдарын қарау (сатып алушы, тауарлар, жеткізу мекенжайы, төлем)

5. **Санаттарды басқару модулі**
   - Тауарлардың жаһандық санаттарын жасау
   - Санаттарды қайта атау және жою
   - Тауарларды санаттар арасында көшіру

6. **Аналитика және есептілік модулі**
   - Кезең бойынша сатылымдар туралы PDF-есептерді жасау
   - Деректерді Excel-ге экспорттау (CSV)
   - Тауар санаттары бойынша аналитика
   - Сатушылар бойынша аналитика (ең көп сатқан кім)
   - Қаржылық есептілік (кіріс, пайда)

7. **Қауіпсіздік және логтар модулі**
   - Пайдаланушылардың әрекеттерінің логтарын қарау
   - Күдікті белсенділікті мониторинг
   - Қол жетімділік құқықтарын басқару

**Технологиялар:**
- React компоненттері: `AdminPage`, `AdminDashboard`, `UsersManagement`, `OrdersManagement`, `ProductsManagement`
- Services: `UserService`, `OrderService`, `PDFService`

---

### 2.1.4. API архитектурасы (Application Programming Interface)

Backend клиенттік бөлікпен өзара әрекеттесу үшін **RESTful API** ұсынады. Барлығы **59 endpoints** іске асырылған, 13 модульге бөлінген.

**API құрылымы:**

```
/api/v1/
├── auth/                 # Аутентификация және тіркеу (4 endpoint)
│   ├── POST   /register
│   ├── POST   /login
│   ├── GET    /me
│   └── PUT    /me
│
├── users/                # Пайдаланушыларды басқару (8 endpoints)
│   ├── GET    /
│   ├── GET    /{user_id}
│   ├── POST   /
│   ├── PUT    /{user_id}
│   ├── DELETE /{user_id}
│   ├── POST   /{user_id}/change-role
│   ├── POST   /{user_id}/toggle-active
│   └── GET    /stats
│
├── products/             # Тауарларды басқару (10 endpoints)
│   ├── GET    /
│   ├── GET    /{product_id}
│   ├── POST   /
│   ├── PUT    /{product_id}
│   ├── DELETE /{product_id}
│   ├── GET    /seller/my
│   ├── GET    /category/{category_id}
│   ├── POST   /search
│   ├── GET    /featured
│   └── GET    /top-selling
│
├── categories/           # Санаттарды басқару (5 endpoints)
│   ├── GET    /
│   ├── GET    /{category_id}
│   ├── POST   /
│   ├── PUT    /{category_id}
│   └── DELETE /{category_id}
│
├── cart/                 # Сатып алу себеті (5 endpoints)
│   ├── GET    /
│   ├── POST   /add
│   ├── PUT    /update/{item_id}
│   ├── DELETE /remove/{item_id}
│   └── DELETE /clear
│
├── wishlist/             # Таңдаулылар (4 endpoints)
│   ├── GET    /
│   ├── POST   /add
│   ├── DELETE /remove/{product_id}
│   └── POST   /move-to-cart/{product_id}
│
├── orders/               # Тапсырыстар (9 endpoints)
│   ├── GET    /
│   ├── GET    /my
│   ├── GET    /{order_id}
│   ├── POST   /create
│   ├── PUT    /{order_id}/status
│   ├── DELETE /{order_id}
│   ├── GET    /seller/my
│   ├── GET    /stats
│   └── POST   /export-pdf
│
├── reviews/              # Пікірлер (5 endpoints)
│   ├── GET    /product/{product_id}
│   ├── POST   /product/{product_id}
│   ├── PUT    /{review_id}
│   ├── DELETE /{review_id}
│   └── GET    /my
│
├── payments/             # Төлемдер (3 endpoints)
│   ├── POST   /create-payment
│   ├── GET    /status/{payment_id}
│   └── POST   /confirm/{payment_id}
│
├── wallet/               # Әмиян (4 endpoints)
│   ├── GET    /
│   ├── POST   /deposit
│   ├── GET    /transactions
│   └── POST   /withdraw
│
├── analytics/            # Аналитика (4 endpoints)
│   ├── GET    /dashboard
│   ├── GET    /sales-chart
│   ├── GET    /top-products
│   └── GET    /revenue-stats
│
├── uploads/              # Файлдарды жүктеу (2 endpoints)
│   ├── POST   /image
│   └── DELETE /image/{filename}
│
└── websocket/            # WebSocket байланысы (1 endpoint)
    └── WS     /ws/{user_id}
```

**API құрудың қағидалары:**

1. **RESTful стандарт**: HTTP әдістерін (GET, POST, PUT, DELETE) олардың семантикасына сәйкес пайдалану
2. **Версиялау**: көне клиенттерді бұзбай v2 жасау мүмкіндігі үшін `/api/v1/` префиксі
3. **Бірыңғай жауаптар**: барлық endpoints `success`, `data`, `message` өрістері бар JSON қайтарады
4. **HTTP статус кодтары**: 200 (OK), 201 (Created), 400 (Bad Request), 401 (Unauthorized), 404 (Not Found), 500 (Server Error)
5. **Аутентификация**: Bearer Token (JWT) `Authorization` тақырыбында беріледі
6. **Құжаттама**: `/docs` мекенжайында Swagger UI автоматты жасау

---

### 2.1.5. Аутентификация және авторизация механизмі

Жүйе қауіпсіздігін қамтамасыз ету үшін **JWT (JSON Web Tokens)** негізіндегі механизм іске асырылған.

**Аутентификация процесі:**

```
1. Пайдаланушыны тіркеу
   ┌──────────┐                  ┌──────────┐                 ┌──────────┐
   │ Клиент   │                  │  Сервер  │                 │    ДҚ    │
   └────┬─────┘                  └────┬─────┘                 └────┬─────┘
        │ POST /auth/register         │                            │
        │ {email, password, name}     │                            │
        │─────────────────────────────>                            │
        │                              │ Құпия сөзді хэштеу        │
        │                              │ (bcrypt)                  │
        │                              │                           │
        │                              │ INSERT INTO users         │
        │                              │───────────────────────────>
        │                              │                           │
        │                              │<───────────────────────────
        │                              │ user_id = 123             │
        │                              │                           │
        │                              │ JWT-токенін жасау         │
        │                              │ (қолданылу мерзімі: 7 күн)│
        │                              │                           │
        │<─────────────────────────────│                           │
        │ {token: "eyJhbGc...",        │                           │
        │  user: {...}}                │                           │
        │                              │                           │
   ┌────▼─────┐                  ┌────▼─────┐                 ┌────▼─────┐
   │ Клиент   │                  │  Сервер  │                 │    ДҚ    │
   │ Токенді  │                  └──────────┘                 └──────────┘
   │ localStorage│
   │ сақтайды │
   └──────────┘

2. Жүйеге кіру
   ┌──────────┐                  ┌──────────┐                 ┌──────────┐
   │ Клиент   │                  │  Сервер  │                 │    ДҚ    │
   └────┬─────┘                  └────┬─────┘                 └────┬─────┘
        │ POST /auth/login            │                            │
        │ {email, password}           │                            │
        │─────────────────────────────>                            │
        │                              │ SELECT * FROM users       │
        │                              │ WHERE email = ?           │
        │                              │───────────────────────────>
        │                              │                           │
        │                              │<───────────────────────────
        │                              │ user + hashed_password    │
        │                              │                           │
        │                              │ Құпия сөзді тексеру       │
        │                              │ bcrypt.verify()           │
        │                              │                           │
        │                              │ JWT жасау                 │
        │                              │                           │
        │<─────────────────────────────│                           │
        │ {token: "eyJhbGc...",        │                           │
        │  user: {...}}                │                           │

3. Қорғалған ресурстарға қол жеткізу
   ┌──────────┐                  ┌──────────┐                 ┌──────────┐
   │ Клиент   │                  │  Сервер  │                 │    ДҚ    │
   └────┬─────┘                  └────┬─────┘                 └────┬─────┘
        │ GET /api/v1/orders/my       │                            │
        │ Authorization: Bearer <JWT> │                            │
        │─────────────────────────────>                            │
        │                              │ JWT тексеру               │
        │                              │ jose.decode()             │
        │                              │                           │
        │                              │ user_id алу               │
        │                              │                           │
        │                              │ SELECT * FROM orders      │
        │                              │ WHERE user_id = ?         │
        │                              │───────────────────────────>
        │                              │                           │
        │                              │<───────────────────────────
        │<─────────────────────────────│ orders data               │
        │ {orders: [...]}              │                           │
```

**Пайдаланушы рөлдері және қол жеткізу құқықтары:**

| Endpoint | Customer | Seller | Admin |
|----------|----------|--------|-------|
| GET /products | ✅ | ✅ | ✅ |
| POST /products | ❌ | ✅ | ✅ |
| DELETE /products/{id} | ❌ | ✅ (тек өзінікі) | ✅ (кез келген) |
| GET /orders/my | ✅ | ✅ | ✅ |
| GET /orders/ (барлық тапсырыстар) | ❌ | ❌ | ✅ |
| POST /users/{id}/change-role | ❌ | ❌ | ✅ |
| GET /analytics/dashboard | ❌ | ✅ (өз деректері) | ✅ (барлық деректер) |

---

### 2.1.6. Қателерді және ерекшеліктерді өңдеу

Жүйе жауаптардың үйлесімділігін қамтамасыз ету үшін орталықтандырылған қателерді өңдеуді пайдаланады.

**Қате түрлері:**

1. **Тексеру қателері (400 Bad Request)**
   ```json
   {
     "success": false,
     "message": "Validation Error",
     "errors": [
       {"field": "email", "message": "Жарамсыз email форматы"},
       {"field": "price", "message": "Баға 0-ден үлкен болуы керек"}
     ]
   }
   ```

2. **Аутентификация қателері (401 Unauthorized)**
   ```json
   {
     "success": false,
     "message": "Жарамсыз токен немесе токен мерзімі өтті"
   }
   ```

3. **Авторизация қателері (403 Forbidden)**
   ```json
   {
     "success": false,
     "message": "Бұл әрекетті орындауға рұқсатыңыз жоқ"
   }
   ```

4. **"Табылмады" қателері (404 Not Found)**
   ```json
   {
     "success": false,
     "message": "id=123 тауар табылмады"
   }
   ```

5. **Сервер қателері (500 Internal Server Error)**
   ```json
   {
     "success": false,
     "message": "Ішкі сервер қатесі. Кейінірек қайталап көріңіз.",
     "error_id": "ERR-20260202-1234"
   }
   ```

---

## 2.2. Дерекқорды жобалау

### 2.2.1. Деректердің инфологиялық моделі

Жүйенің дерекқоры пайдаланушылар, тауарлар, тапсырыстар және басқа сауда процесі нысандары туралы ақпаратты сақтау үшін жобаланған.

**Негізгі нысандар (кестелер):**

1. **Users (Пайдаланушылар)** - жүйенің барлық пайдаланушылары туралы ақпарат
2. **Products (Тауарлар)** - дүкен тауарларының каталогы
3. **Categories (Санаттар)** - тауарларды жіктеу санаттары
4. **Orders (Тапсырыстар)** - сатып алушылардың тапсырыстары туралы ақпарат
5. **OrderItems (Тапсырыс позициялары)** - тапсырыстар мен тауарлардың байланысы (не тапсырыс берілген)
6. **CartItems (Себет)** - пайдаланушы себетіндегі тауарлар
7. **WishlistItems (Таңдаулылар)** - пайдаланушының тілектер тізімі
8. **Reviews (Пікірлер)** - тауарларға сатып алушылардың пікірлері
9. **Wallets (Әмияндар)** - төлем үшін пайдаланушылар балансы

---

### 2.2.2. Дерекқор кестелерінің егжей-тегжейлі сипаттамасы

#### 1-кесте: users

**Мақсаты:** Жүйе пайдаланушылары (сатып алушылар, сатушылар, әкімшілер) туралы ақпаратты сақтау.

| Өріс | Деректер түрі | Шектеулер | Сипаттама |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Пайдаланушының бірегей идентификаторы |
| email | VARCHAR(255) | UNIQUE, NOT NULL | Жүйеге кіру үшін email |
| password_hash | VARCHAR(255) | NOT NULL | Хэштелген құпия сөз (bcrypt) |
| first_name | VARCHAR(100) | NOT NULL | Пайдаланушының аты |
| last_name | VARCHAR(100) | NOT NULL | Пайдаланушының тегі |
| phone | VARCHAR(20) | NULL | Байланыс телефоны |
| address | TEXT | NULL | Жеткізу мекенжайы |
| role | VARCHAR(20) | NOT NULL, DEFAULT 'customer' | Рөлі: customer, seller, admin |
| is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | Аккаунт белсенді ме |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Тіркелу күні |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Соңғы жаңарту күні |

**Индекстер:**
- `idx_users_email` `email` өрісінде - кіру кезінде жылдам іздеу үшін
- `idx_users_role` `role` өрісінде - рөлдер бойынша сүзгілеу үшін

---

#### 2-кесте: categories

**Мақсаты:** Каталогты құрылымдау үшін тауар санаттары.

| Өріс | Деректер түрі | Шектеулер | Сипаттама |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Санаттың бірегей идентификаторы |
| name | VARCHAR(100) | UNIQUE, NOT NULL | Санат атауы (мысалы, "Сүт өнімдері") |
| description | TEXT | NULL | Санат сипаттамасы |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Жасалу күні |

**Санаттар мысалдары:**
- Сүт өнімдері
- Нан өнімдері
- Ет және құс
- Көкөністер мен жемістер
- Сусындар
- Азық-түлік

---

#### 3-кесте: products

**Мақсаты:** Дүкен тауарлары туралы ақпаратты сақтау.

| Өріс | Деректер түрі | Шектеулер | Сипаттама |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Тауардың бірегей идентификаторы |
| name | VARCHAR(255) | NOT NULL | Тауар атауы |
| description | TEXT | NULL | Толық сипаттама |
| price | DECIMAL(10, 2) | NOT NULL, CHECK (price >= 0) | Тауар бағасы |
| stock_quantity | INTEGER | NOT NULL, DEFAULT 0, CHECK (stock_quantity >= 0) | Қоймадағы саны |
| category_id | INTEGER | FOREIGN KEY → categories(id), NULL | Тауар санаты |
| seller_id | INTEGER | FOREIGN KEY → users(id), NOT NULL | Тауар сатушысы |
| image_urls | JSON | NULL | Тауар суреттерінің URL массиві |
| is_active | BOOLEAN | NOT NULL, DEFAULT TRUE | Тауар белсенді ме (каталогта көрсетіледі) |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Қосылу күні |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Соңғы жаңарту күні |

**Индекстер:**
- `idx_products_category` `category_id` өрісінде - санаттар бойынша сүзгілеу үшін
- `idx_products_seller` `seller_id` өрісінде - сатушы тауарларын іріктеу үшін
- `idx_products_price` `price` өрісінде - баға бойынша сұрыптау үшін

**Жазба мысалы:**
```
id: 45
name: "Сүт 'Веселый молочник' 3.2%"
description: "Жоғары сапалы пастерленген сүт"
price: 450.00
stock_quantity: 120
category_id: 1 (Сүт өнімдері)
seller_id: 7
image_urls: ["static/uploads/products/milk_front.jpg", "static/uploads/products/milk_back.jpg"]
is_active: true
```

---

#### 4-кесте: orders

**Мақсаты:** Сатып алушылардың тапсырыстары туралы ақпарат.

| Өріс | Деректер түрі | Шектеулер | Сипаттама |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Бірегей тапсырыс нөмірі |
| user_id | INTEGER | FOREIGN KEY → users(id), NOT NULL | Сатып алушы |
| total_amount | DECIMAL(10, 2) | NOT NULL, CHECK (total_amount >= 0) | Тапсырыстың жалпы сомасы |
| status | VARCHAR(20) | NOT NULL, DEFAULT 'pending' | Мәртебе: pending, processing, completed, cancelled |
| delivery_address | TEXT | NOT NULL | Жеткізу мекенжайы |
| phone | VARCHAR(20) | NOT NULL | Байланыс телефоны |
| payment_method | VARCHAR(20) | NOT NULL | Төлем әдісі: wallet, card, cash |
| notes | TEXT | NULL | Тапсырысқа түсініктемелер |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Тапсырыс жасалу күні |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Соңғы жаңарту күні |

**Индекстер:**
- `idx_orders_user` `user_id` өрісінде - пайдаланушы тапсырыстарын іріктеу үшін
- `idx_orders_status` `status` өрісінде - мәртебе бойынша сүзгілеу үшін
- `idx_orders_created_at` `created_at` өрісінде - күні бойынша сұрыптау үшін

**Тапсырыс мәртебелерінің мүмкін мәндері:**
- `pending` - растауды күтуде
- `processing` - өңделуде (жиналуда)
- `completed` - орындалған (жеткізілген)
- `cancelled` - болдырылған

---

#### 5-кесте: order_items

**Мақсаты:** Тапсырыс құрамы (қандай тауарлар және қанша саны тапсырысқа кіреді).

| Өріс | Деректер түрі | Шектеулер | Сипаттама |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Позицияның бірегей идентификаторы |
| order_id | INTEGER | FOREIGN KEY → orders(id), ON DELETE CASCADE, NOT NULL | Тапсырыс |
| product_id | INTEGER | FOREIGN KEY → products(id), ON DELETE RESTRICT, NOT NULL | Тауар |
| quantity | INTEGER | NOT NULL, CHECK (quantity > 0) | Тауар бірліктерінің саны |
| price_at_purchase | DECIMAL(10, 2) | NOT NULL | Сатып алу кезіндегі тауар бағасы |
| subtotal | DECIMAL(10, 2) | NOT NULL | Позиция бойынша жалпы (quantity * price) |

**Маңызды:** 
- `ON DELETE CASCADE` order_id үшін - тапсырыс жойылған кезде оның позициялары да жойылады
- `ON DELETE RESTRICT` product_id үшін - тапсырыстарда бар тауарды жою мүмкін емес (тарихты сақтау)
- `price_at_purchase` кейінірек каталогтағы баға өзгерсе де, сатып алу кезіндегі бағаны бекітеді

**Құрама индекс:**
- `idx_order_items_order_product` `(order_id, product_id)` - тапсырыстағы тауардың бірегейлігі

**Мысал:**
```
Тапсырыс #1234:
  - Позиция 1: Сүт, 2 дана, бағасы 450 тг, жалпы 900 тг
  - Позиция 2: Нан, 1 дана, бағасы 200 тг, жалпы 200 тг
  - Позиция 3: Ірімшік, 1 дана, бағасы 1500 тг, жалпы 1500 тг
Жалпы тапсырыс: 2600 тг
```

---

#### 6-кесте: cart_items

**Мақсаты:** Пайдаланушының сатып алу себеті (тапсырысты рәсімдеуге дейін уақытша сақтау).

| Өріс | Деректер түрі | Шектеулер | Сипаттама |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Жазбаның бірегей идентификаторы |
| user_id | INTEGER | FOREIGN KEY → users(id), ON DELETE CASCADE, NOT NULL | Пайдаланушы |
| product_id | INTEGER | FOREIGN KEY → products(id), ON DELETE CASCADE, NOT NULL | Тауар |
| quantity | INTEGER | NOT NULL, CHECK (quantity > 0) | Саны |
| added_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Себетке қосылу күні |

**Бірегей индекс:**
- `uq_cart_user_product` `(user_id, product_id)` - бір тауар себетте бір рет болуы мүмкін (қайта қосқанда quantity көбейеді)

**order_items-тан айырмашылығы:**
- Себет - уақытша сақтау, тапсырыс - тұрақты тарих
- Тапсырысты рәсімдеген кезде деректер cart_items-тан order_items-ке көшіріледі, содан кейін себет тазаланады

---

#### 7-кесте: wishlist_items

**Мақсаты:** Таңдаулы тауарлар тізімі (тілектер тізімі).

| Өріс | Деректер түрі | Шектеулер | Сипаттама |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Бірегей идентификатор |
| user_id | INTEGER | FOREIGN KEY → users(id), ON DELETE CASCADE, NOT NULL | Пайдаланушы |
| product_id | INTEGER | FOREIGN KEY → products(id), ON DELETE CASCADE, NOT NULL | Тауар |
| added_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Қосылу күні |

**Бірегей индекс:**
- `uq_wishlist_user_product` `(user_id, product_id)` - бір тауар таңдаулыларда бір рет

---

#### 8-кесте: reviews

**Мақсаты:** Тауарларға сатып алушылардың пікірлері.

| Өріс | Деректер түрі | Шектеулер | Сипаттама |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Пікірдің бірегей идентификаторы |
| user_id | INTEGER | FOREIGN KEY → users(id), ON DELETE CASCADE, NOT NULL | Пікір авторы |
| product_id | INTEGER | FOREIGN KEY → products(id), ON DELETE CASCADE, NOT NULL | Тауар |
| rating | INTEGER | NOT NULL, CHECK (rating >= 1 AND rating <= 5) | 1-ден 5 жұлдызға дейін баға |
| comment | TEXT | NULL | Пікір мәтіні |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Жасалу күні |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Өңдеу күні |

**Индекстер:**
- `idx_reviews_product` `product_id` - тауардың барлық пікірлерін іріктеу үшін
- `idx_reviews_user` `user_id` - пайдаланушының барлық пікірлерін қарау үшін

**Шектеу:** Бір пайдаланушы тауарға бір пікір қалдыра алады
- Бірегей индекс `uq_review_user_product` `(user_id, product_id)`

---

#### 9-кесте: wallets

**Мақсаты:** Тапсырыстарды төлеу үшін пайдаланушылардың виртуалды әмияндары.

| Өріс | Деректер түрі | Шектеулер | Сипаттама |
|------|------------|-------------|----------|
| id | INTEGER | PRIMARY KEY, AUTOINCREMENT | Әмиянның бірегей идентификаторы |
| user_id | INTEGER | FOREIGN KEY → users(id), UNIQUE, ON DELETE CASCADE, NOT NULL | Пайдаланушы (пайдаланушыға бір әмиян) |
| balance | DECIMAL(10, 2) | NOT NULL, DEFAULT 0.00, CHECK (balance >= 0) | Әмиян балансы |
| created_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Жасалу күні |
| updated_at | TIMESTAMP | NOT NULL, DEFAULT CURRENT_TIMESTAMP | Соңғы жаңарту күні |

**Ерекшеліктер:**
- Пайдаланушы тіркелген кезде автоматты түрде 0 балансымен әмиян жасалады
- Баланс теріс болуы мүмкін емес (CHECK constraint)
- Балансты толықтыру `/api/v1/wallet/deposit` endpoint арқылы жүреді
- Wallet арқылы тапсырысты төлеген кезде баланс тапсырыс сомасына кемиді

---

### 2.2.3. ER-диаграмма (Entity-Relationship Diagram)

ER-диаграмма дерекқор кестелері арасындағы байланыстарды көрнекі түрде көрсетеді.

```
┌────────────────────┐
│      USERS         │
├────────────────────┤
│ • id (PK)          │
│ • email (UNIQUE)   │
│ • password_hash    │
│ • first_name       │
│ • last_name        │
│ • role             │
│ • is_active        │
└──────┬─────────────┘
       │
       │ 1
       │
       │ (seller_id)
       │ (user_id)
       ├──────────────────────────┐
       │                          │
       │ N                        │ N
       │                          │
┌──────▼─────────┐         ┌──────▼─────────┐
│   PRODUCTS     │         │     ORDERS     │
├────────────────┤         ├────────────────┤
│ • id (PK)      │         │ • id (PK)      │
│ • name         │         │ • user_id (FK) │
│ • price        │         │ • total_amount │
│ • stock_qty    │         │ • status       │
│ • category_id  │◄────┐   │ • delivery_addr│
│ • seller_id    │     │   │ • payment_meth │
│ • image_urls   │     │   └────────┬───────┘
└──┬─────────────┘     │            │
   │                   │            │ 1
   │ 1                 │ N          │
   │                   │            │
   │              ┌────┴────────┐   │ N
   │              │ CATEGORIES  │   │
   │              ├─────────────┤   │
   │              │ • id (PK)   │   │
   │              │ • name      │   │
   │              │ • desc      │   │
   │              └─────────────┘   │
   │                                │
   │ N                              │
   │                                │
┌──▼──────────────────┐    ┌────────▼───────────┐
│    CART_ITEMS       │    │   ORDER_ITEMS      │
├─────────────────────┤    ├────────────────────┤
│ • id (PK)           │    │ • id (PK)          │
│ • user_id (FK)      │    │ • order_id (FK)    │
│ • product_id (FK)   │    │ • product_id (FK)  │
│ • quantity          │    │ • quantity         │
│ • added_at          │    │ • price_at_purchase│
└─────────────────────┘    │ • subtotal         │
                           └────────────────────┘

┌─────────────────────┐
│   WISHLIST_ITEMS    │
├─────────────────────┤
│ • id (PK)           │
│ • user_id (FK)      │
│ • product_id (FK)   │
│ • added_at          │
└─────────────────────┘

┌─────────────────────┐
│      REVIEWS        │
├─────────────────────┤
│ • id (PK)           │
│ • user_id (FK)      │
│ • product_id (FK)   │
│ • rating (1-5)      │
│ • comment           │
│ • created_at        │
└─────────────────────┘

┌─────────────────────┐
│      WALLETS        │
├─────────────────────┤
│ • id (PK)           │
│ • user_id (FK, UQ)  │
│ • balance           │
│ • updated_at        │
└─────────────────────┘
```

**Байланыс түрлері:**

1. **Users → Products (1:N)** - бір сатушы көптеген тауарлар жасай алады
2. **Categories → Products (1:N)** - бір санат көптеген тауарларды қамтиды
3. **Users → Orders (1:N)** - бір пайдаланушы көптеген тапсырыс бере алады
4. **Orders → OrderItems (1:N)** - бір тапсырыс көптеген позицияларды қамтиды
5. **Products → OrderItems (1:N)** - бір тауар көптеген тапсырыстарда болуы мүмкін
6. **Users → CartItems (1:N)** - бір пайдаланушының себетінде бірнеше тауар болуы мүмкін
7. **Products → CartItems (1:N)** - бір тауар әр түрлі пайдаланушылардың себетінде болуы мүмкін
8. **Users → WishlistItems (1:N)** - пайдаланушының таңдаулыларында бірнеше тауар болуы мүмкін
9. **Products → WishlistItems (1:N)** - тауар әр түрлі пайдаланушылардың таңдаулыларында болуы мүмкін
10. **Users → Reviews (1:N)** - пайдаланушы көптеген пікірлер қалдыра алады
11. **Products → Reviews (1:N)** - тауарда көптеген пікірлер болуы мүмкін
12. **Users → Wallets (1:1)** - әрбір пайдаланушыда дәл бір әмиян

---

### 2.2.4. Деректер қауіпсіздігін жобалау

Деректер қауіпсіздігі бірнеше деңгейде қамтамасыз етіледі.

#### 1. Пайдаланушы құпия сөздерін қорғау

**Мәселе:** Құпия сөздерді ашық түрде сақтау қауіпті - дерекқор ағып кетсе, заңсыз пайдаланушылар барлық аккаунттарға қол жеткізеді.

**Шешім:** Құпия сөздерді **bcrypt** алгоритмін пайдаланып хэштеу.

**Жұмыс принципі:**

```
Пайдаланушыны тіркеу:
1. Пайдаланушы құпия сөзді енгізеді: "MySecurePass123"
2. Сервер salt-пен (кездейсоқ жол) bcrypt қолданады:
   hashed_password = bcrypt.hash("MySecurePass123" + salt)
   Нәтиже: "$2b$12$KIXxLkR8M9k3fN1pZ7YQW.jE3hP2vR8tL9mK4nQ6w..."
3. Дерекқорда тек хэш сақталады, құпия сөз ашық түрде ешқайда сақталмайды

Жүйеге кіру:
1. Пайдаланушы құпия сөзді енгізеді: "MySecurePass123"
2. Сервер бұл email үшін дерекқордан хэшті алады
3. Сервер салыстырады: bcrypt.verify("MySecurePass123", hashed_password_from_db)
4. Егер сәйкес келсе - қол жеткізуге рұқсат
```

**bcrypt артықшылықтары:**
- Хэшті бастапқы құпия сөзге қайтару мүмкін емес
- Әр жолы бірдей құпия сөздер үшін де хэш әр түрлі (salt арқасында)
- Әдейі баяу алгоритм (brute-force шабуылдардан қорғау)

---

#### 2. SQL-инъекциялардан қорғау

**Мәселе:** SQL-инъекция - заңсыз пайдаланушы енгізу өрістері арқылы зиянды SQL-кодты кірістіреді.

**Шабуыл мысалы:**
```
Пайдаланушы email өрісіне енгізеді: admin@shop.com' OR '1'='1
Қорғаусыз SQL-сұраныс болады:
SELECT * FROM users WHERE email = 'admin@shop.com' OR '1'='1'
'1'='1' шарты әрқашан шын → БАРЛЫҚ пайдаланушылар қайтарылады!
```

**Шешім:** SQLAlchemy ORM арқылы **параметрленген сұраныстарды** пайдалану.

```python
# ҚАУІПТІ (инъекцияларға осал):
email = request.data['email']
query = f"SELECT * FROM users WHERE email = '{email}'"
db.execute(query)

# ҚАУІПСІЗ (SQLAlchemy параметрлерді экрандайды):
email = request.data['email']
user = db.query(User).filter(User.email == email).first()
```

SQLAlchemy автоматты түрде барлық арнайы таңбаларды экрандайды, инъекцияны мүмкін етпейді.

---

#### 3. XSS-тан (Cross-Site Scripting) қорғау

**Мәселе:** Заңсыз пайдаланушы енгізу өрістеріне JavaScript-кодты кірістіре алады (мысалы, тауар сипаттамасына).

**Шешім:**
- Backend: Pydantic деректер түрлерін тексереді, HTML-тегтерді беруге рұқсат етпейді
- Frontend: React рендерлеу кезінде барлық деректерді автоматты түрде экрандайды

---

#### 4. JWT көмегімен API қорғау

**Механизм:**
- Барлық қорғалған endpoints `Authorization: Bearer <token>` тақырыбында токен талап етеді
- Токен жарамдылыққа тексеріледі (қолданылу мерзімі, қолтаңба)
- user_id алынады және қол жеткізу құқықтары тексеріледі

**Токенді қолдану мерзімі:** 7 күн (мерзімі өткеннен кейін пайдаланушы қайтадан кіруі керек)

---

#### 5. CORS (Cross-Origin Resource Sharing)

**Мәселе:** Әдепкі бойынша браузерлер бір доменнен екінші доменге сұраныстарды тыйым салады.

**Шешім:** FastAPI тек development-та `http://localhost:5173` (frontend) және production-да жұмыс доменінен сұраныстарды қабылдауға конфигурацияланған.

```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["http://localhost:5173"],  # тек бұл домен
    allow_credentials=True,
    allow_methods=["GET", "POST", "PUT", "DELETE"],
    allow_headers=["*"],
)
```

---

#### 6. Rate Limiting (сұраныс жиілігін шектеу)

**Мәселе:** Заңсыз пайдаланушы серверді көптеген сұраныстармен шамадан тыс жүктей алады (DDoS-шабуыл) немесе құпия сөздерді іріктей алады.

**Шешім:** Бір IP-мекенжайдан сұраныстар санына шектеу (мысалы, минутына 100-ден аспайды).

---

#### 7. Дерекқор деңгейінде деректерді тексеру

**Кестелердегі Constraints (шектеулер):**

```sql
-- Баға теріс болуы мүмкін емес
CHECK (price >= 0)

-- Қоймадағы сан теріс болуы мүмкін емес
CHECK (stock_quantity >= 0)

-- Рейтинг тек 1-ден 5-ке дейін
CHECK (rating >= 1 AND rating <= 5)

-- Email бірегей болуы керек
UNIQUE (email)

-- Себетте бір тауар тек бір рет
UNIQUE (user_id, product_id)
```

Бұл шектеулер қосымша кодта қате болса да, қате деректерді кірістіруге жол бермейді.

---

## 2.3. Пайдаланушы интерфейсін жобалау (UX/UI)

### 2.3.1. Сайт құрылымы (Sitemap)

Sitemap веб-қосымшаның барлық беттерінің иерархиясын көрсетеді.

```
БАС БЕТ (/)
│
├── АУТЕНТИФИКАЦИЯ
│   ├── Кіру беті (/login)
│   └── Тіркелу беті (/register)
│
├── ТАУАРЛАР КАТАЛОГЫ
│   ├── Бас бет - барлық тауарлар тізімі (/)
│   ├── Деталдармен тауар беті (/product/:id)
│   └── Тауарларды іздеу (/search?q=сүт)
│
├── СЕБЕТ ЖӘНЕ ТАПСЫРЫСТАР (тек авторизацияланғандар үшін)
│   ├── Себет беті (/cart)
│   ├── Тапсырысты рәсімдеу беті (/checkout)
│   ├── Тапсырыстар тарихы (/orders)
│   └── Тапсырыс деталдары (/order/:id)
│
├── ТАҢДАУЛЫЛАР (тек авторизацияланғандар үшін)
│   └── Таңдаулылар беті (/wishlist)
│
├── САТУШЫ ПАНЕЛІ (/seller) - тек role=seller үшін
│   ├── Тауарларды басқару ("Менің тауарларым" қойындысы)
│   ├── Жаңа тауар қосу (модальді терезе)
│   ├── Тауарды өңдеу (модальді терезе)
│   ├── Менің тауарларым бар тапсырыстар ("Тапсырыстар" қойындысы)
│   └── Сатылым аналитикасы ("Аналитика" қойындысы)
│
├── ӘКІМШІ ПАНЕЛІ (/admin) - тек role=admin үшін
│   ├── Dashboard (негізгі статистика)
│   ├── Пайдаланушыларды басқару ("Пайдаланушылар" қойындысы)
│   ├── Барлық сатушылардың тауарларын басқару ("Тауарлар" қойындысы)
│   ├── Тапсырыстарды басқару ("Тапсырыстар" қойындысы)
│   └── Санаттарды басқару ("Санаттар" қойындысы)
│
├── ЖЕКЕ КАБИНЕТ
│   └── Пайдаланушы профилі (/profile)
│
└── ҚЫЗМЕТТІК БЕТТЕР
    └── 404 бет (табылмады) (/*)
```

---

### 2.3.2. Негізгі беттер мен компоненттердің сипаттамасы

#### 1. Бас бет (HomePage)

**Мақсаты:** Іздеу және сүзгілеу мүмкіндігімен барлық тауарлар каталогын көрсету.

**Құрылым:**

```
┌──────────────────────────────────────────────────────────────┐
│  HEADER (сайт тақырыбы)                                      │
│  ┌────────────┐  [Тауарларды іздеу...🔍]  🛒(3) ❤️(2) 👤Профиль│
│  │ LOGO       │                                              │
│  │ "Bibarys"  │                                              │
│  └────────────┘                                              │
├──────────────────────────────────────────────────────────────┤
│  НАВИГАЦИЯ                                                   │
│  [Барлық тауарлар]  [Санаттар ▼]  [Біз туралы]  [Байланыс]  │
├──────────────────────────────────────────────────────────────┤
│  БАННЕР (Hero Section)                                       │
│  ┌────────────────────────────────────────────────────────┐ │
│  │  "Bibarys-қа қош келдіңіз!"                           │ │
│  │  Сапалы өнімдердің кең таңдауы                         │ │
│  │  [Каталогты қарау →]                                   │ │
│  └────────────────────────────────────────────────────────┘ │
├──────────────────────────────────────────────────────────────┤
│  СҮЗГІЛЕР                                                    │
│  Санат: [Барлығы ▼]  Баға: бастап[___] дейін[___]  [Қолдану]│
├──────────────────────────────────────────────────────────────┤
│  ТАУАРЛАР ТОРЫ (3-4 баған)                                   │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐           │
│  │[Тауар фото]│  │[Тауар фото]│  │[Тауар фото]│           │
│  │            │  │            │  │            │           │
│  │Сүт 3.2%    │  │Ақ нан      │  │Гауда ірімшігі│         │
│  │450 ₸       │  │200 ₸       │  │1500 ₸      │           │
│  │⭐⭐⭐⭐⭐(12)│  │⭐⭐⭐⭐(8)  │  │⭐⭐⭐⭐⭐(5)│           │
│  │[Себетке]   │  │[Себетке]   │  │[Себетке]   │           │
│  │❤️ Таңдаулыларға│  │❤️ Таңдаулыларға│  │❤️ Таңдаулыларға│   │
│  └────────────┘  └────────────┘  └────────────┘           │
│                                                              │
│  [...тағы тауарлар...]                                      │
│  [Қосымша жүктеу]                                           │
├──────────────────────────────────────────────────────────────┤
│  FOOTER (сайт төменгі жағы)                                  │
│  Компания туралы | Байланыс | Құпиялылық саясаты            │
│  © 2026 Bibarys. Барлық құқықтар қорғалған.                 │
└──────────────────────────────────────────────────────────────┘
```

**Функциялар:**
- Атауы бойынша тауарларды іздеу (нақты уақытта)
- Санаттар және баға диапазоны бойынша сүзгілеу
- Фото, атау, баға, рейтингі бар тауар карточкаларын көрсету
- "Себетке" және "Таңдаулыларға" батырмалары
- Карточканы басу → тауар детал бетіне өту

---

#### 2. Тауар беті (ProductDetailsPage)

**Мақсаты:** Себетке қосу мүмкіндігімен тауар туралы толық ақпарат.

**Құрылым:**

```
┌────────────────────────────────────────────────────────────┐
│  [← Каталогқа оралу]                                       │
├────────────────────────────────────────────────────────────┤
│  ┌───────────────────────┐  ┌──────────────────────────┐  │
│  │  СУРЕТТЕР ГАЛЕРЕЯСЫ   │  │  ТАУАР ТУРАЛЫ АҚПАРАТ    │  │
│  │  ┌─────────────────┐  │  │                          │  │
│  │  │  [Басты фото]   │  │  │  Сүт "Веселый            │  │
│  │  │                 │  │  │  молочник" 3.2%          │  │
│  │  │  [   ТАУАР   ]  │  │  │                          │  │
│  │  │                 │  │  │  ⭐⭐⭐⭐⭐ 4.8 (12 пікір) │  │
│  │  └─────────────────┘  │  │                          │  │
│  │                       │  │  Бағасы: 450 ₸           │  │
│  │  [📷] [📷] [📷] [📷]  │  │  Қойда: 120 дана         │  │
│  │  миниатюралар         │  │                          │  │
│  └───────────────────────┘  │  Санат: Сүт өнімдері     │  │
│                             │  Сатушы: ЖК "Дүкен"      │  │
│                             │                          │  │
│                             │  Сипаттама:              │  │
│                             │  Жоғары сапалы пастерленген│ │
│                             │  сүт...                  │  │
│                             │                          │  │
│                             │  Саны: [-] 1 [+]         │  │
│                             │                          │  │
│                             │  [🛒 Себетке қосу]       │  │
│                             │  [❤️ Таңдаулыларға]      │  │
│                             └──────────────────────────┘  │
├────────────────────────────────────────────────────────────┤
│  ПІКІРЛЕР (12)                      [⭐⭐⭐⭐⭐ Қалдыру]  │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ Иван Петров  ⭐⭐⭐⭐⭐  02.02.2026                    │ │
│  │ Тамаша сүт, жаңа!                                    │ │
│  └──────────────────────────────────────────────────────┘ │
│  [...тағы пікірлер...]                                    │
└────────────────────────────────────────────────────────────┘
```

**Функциялар:**
- Басу бойынша үлкейтумен суреттер галереясы
- Рейтингті және пікірлер санын көрсету
- Тауар санын таңдау
- Қоймада бар-жоғын тексеру
- Себетке/таңдаулыларға қосу
- Пікірлерді қарау және қосу

---

#### 3. Себет беті (CartPage)

**Мақсаты:** Тапсырысты рәсімдеуге дейін себет мазмұнын қарау және өңдеу.

**Құрылым:**

```
┌────────────────────────────────────────────────────────────┐
│  СЕБЕТ (3 тауар)                         [Себетті тазалау] │
├────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────┐ │
│  │ [📷]  Сүт 3.2%                    450 ₸              │ │
│  │       Санат: Сүт өнімдері         Саны: [-] 2 [+]    │ │
│  │       Қойда: 120 дана             Жалпы: 900 ₸      │ │
│  │                                            [🗑️ Жою]  │ │
│  └──────────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ [📷]  Ақ нан                      200 ₸              │ │
│  │       Санат: Нан өнімдері         Саны: [-] 1 [+]    │ │
│  │       Қойда: 50 дана              Жалпы: 200 ₸      │ │
│  │                                            [🗑️ Жою]  │ │
│  └──────────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ [📷]  Гауда ірімшігі              1500 ₸             │ │
│  │       Санат: Сүт өнімдері         Саны: [-] 1 [+]    │ │
│  │       Қойда: 30 дана              Жалпы: 1500 ₸     │ │
│  │                                            [🗑️ Жою]  │ │
│  └──────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────┤
│  ЖАЛПЫ                                                     │
│  ┌──────────────────────────────────────────────────────┐ │
│  │  Тауарлар: 4 дана                                    │ │
│  │  Сома: 2600 ₸                                        │ │
│  │  Жеткізу: Тегін                                      │ │
│  │  ───────────────────────────────────────────────────  │ │
│  │  ТӨЛЕУГЕ ЖАЛПЫ: 2600 ₸                               │ │
│  │                                                       │ │
│  │  [← Сатып алуды жалғастыру]  [Тапсырысты рәсімдеу →]│ │
│  └──────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

**Функциялар:**
- Тауарлар санын өзгерту (қалдықтарды тексерумен)
- Себеттен тауарларды жою
- Жалпы соманы автоматты қайта есептеу
- "Тапсырысты рәсімдеу" өтуі

---

#### 4. Тапсырысты рәсімдеу беті (CheckoutPage)

**Мақсаты:** Жеткізу деректерін енгізу және төлем әдісін таңдау.

**Құрылым:**

```
┌────────────────────────────────────────────────────────────┐
│  ТАПСЫРЫСТЫ РӘСІМДЕУ                                       │
│  ┌─────────────┬──────────────────────────────────────────┐│
│  │  1-қадам ✓  │  1. ЖЕТКІЗУ ДЕРЕКТЕРІ                    ││
│  │  2-қадам    │                                          ││
│  │  3-қадам    │  Жеткізу мекенжайы:                      ││
│  └─────────────┤  [_________________________________]     ││
│                │  Астана қ., Мәңгілік Ел көш., 55/20     ││
│                │                                          ││
│                │  Телефон:                                ││
│                │  [_________________________________]     ││
│                │  +7 (___) ___-__-__                      ││
│                │                                          ││
│                │  Тапсырысқа түсініктеме:                 ││
│                │  [_________________________________]     ││
│                │  [_________________________________]     ││
│                │                                          ││
│                │  [Жалғастыру →]                          ││
│                └──────────────────────────────────────────┘│
│                                                             │
│  ┌─────────────┬──────────────────────────────────────────┐│
│  │  1-қадам ✓  │  2. ТӨЛЕМ ӘДІСІ                          ││
│  │  2-қадам ✓  │                                          ││
│  │  3-қадам    │  ○ Картамен төлеу                        ││
│  └─────────────┤  ● Әмиянмен төлеу (баланс: 5000 ₸)      ││
│                │  ○ Қолма-қол ақша алғанда                ││
│                │                                          ││
│                │  [Жалғастыру →]                          ││
│                └──────────────────────────────────────────┘│
│                                                             │
│  ┌─────────────┬──────────────────────────────────────────┐│
│  │  1-қадам ✓  │  3. РАСТАУ                               ││
│  │  2-қадам ✓  │                                          ││
│  │  3-қадам ✓  │  Сіздің тапсырысыңыз:                    ││
│  └─────────────┤  • Сүт 3.2% × 2 = 900 ₸                  ││
│                │  • Ақ нан × 1 = 200 ₸                    ││
│                │  • Гауда ірімшігі × 1 = 1500 ₸           ││
│                │  ──────────────────────                  ││
│                │  Жалпы: 2600 ₸                           ││
│                │                                          ││
│                │  Мекенжай: Астана қ., Мәңгілік Ел...     ││
│                │  Телефон: +7 (777) 123-45-67             ││
│                │  Төлем: Әмиян                            ││
│                │                                          ││
│                │  [Тапсырысты растау]                     ││
│                └──────────────────────────────────────────┘│
└────────────────────────────────────────────────────────────┘
```

**Функциялар:**
- Үш қадамды рәсімдеу процесі
- Өрістерді тексеру (телефон, мекенжай)
- Балансты тексерумен төлем әдісін таңдау
- Тапсырыс деталдарымен түпкілікті растау

---

#### 5. Сатушы панелі (SellerPage)

**Мақсаты:** Тауарларды басқару және сатылым статистикасын қарау.

**Құрылым ("Менің тауарларым" қойындысы):**

```
┌────────────────────────────────────────────────────────────┐
│  САТУШЫ ПАНЕЛІ                               [+ Жаңа       │
│  [Менің тауарларым] [Тапсырыстар] [Аналитика]  тауар]     │
├────────────────────────────────────────────────────────────┤
│  Іздеу: [___________🔍]  Санат: [Барлығы ▼]              │
├────────────────────────────────────────────────────────────┤
│  МЕНІҢ ТАУАРЛАРЫМ (45)                                     │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ [📷] Сүт 3.2%            Сүт өнімд.  450 ₸   120 дана│ │
│  │      ⭐ 4.8 (12)         Белсенді   [✏️ Өңд.] [🗑️ Жою]│ │
│  └──────────────────────────────────────────────────────┘ │
│  ┌──────────────────────────────────────────────────────┐ │
│  │ [📷] Ақ нан              Нан өнімд.  200 ₸    50 дана│ │
│  │      ⭐ 4.2 (8)          Белсенді   [✏️ Өңд.] [🗑️ Жою]│ │
│  └──────────────────────────────────────────────────────┘ │
│  [...тағы тауарлар...]                                    │
│  [1] [2] [3] ... [9] беттеу                              │
└────────────────────────────────────────────────────────────┘
```

**"Тауар қосу" модальді терезесі:**

```
┌──────────────────────────────────────────────────────────┐
│  ТАУАР ҚОСУ                                         [✕]  │
├──────────────────────────────────────────────────────────┤
│  Атауы: *                                                │
│  [_____________________________________________]         │
│                                                          │
│  Санат: *                                                │
│  [Санат таңдау ▼]                                        │
│                                                          │
│  Баға (₸): *                                             │
│  [____________]                                          │
│                                                          │
│  Қоймадағы саны: *                                       │
│  [____________]                                          │
│                                                          │
│  Сипаттама:                                              │
│  [___________________________________________]           │
│  [___________________________________________]           │
│  [___________________________________________]           │
│                                                          │
│  Тауар фотосуреттері (макс. 5):                          │
│  ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐          │
│  │ [+]  │ │      │ │      │ │      │ │      │          │
│  │Жүктеу│ │      │ │      │ │      │ │      │          │
│  └──────┘ └──────┘ └──────┘ └──────┘ └──────┘          │
│                                                          │
│  [Болдырмау]                         [Тауар қосу]       │
└──────────────────────────────────────────────────────────┘
```

**Функциялар:**
- Тауарлармен CRUD операциялары
- Тауардың 5 фотосуретіне дейін жүктеу
- Тауарларды санаттар бойынша сүзгілеу
- Статистиканы қарау (тауарлар саны, қоймадағы жалпы құны)

---

#### 6. Әкімші панелі (AdminPage)

**Мақсаты:** Жүйені толық бақылау.

**Құрылым (Dashboard):**

```
┌────────────────────────────────────────────────────────────┐
│  ӘКІМШІ ПАНЕЛІ                             👤 Admin        │
│  [Dashboard] [Пайдаланушылар] [Тауарлар] [Тапсырыстар] [Санаттар]│
├────────────────────────────────────────────────────────────┤
│  ЖАЛПЫ СТАТИСТИКА                                          │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │
│  │ 👥 Пайд-лар  │ │ 📦 Тауарлар  │ │ 🛒 Тапсырыстар│     │
│  │    1,234     │ │    567       │ │    890       │      │
│  │    +5 бүгін  │ │    +12 жаңа  │ │    +45 жаңа  │      │
│  └──────────────┘ └──────────────┘ └──────────────┘      │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐      │
│  │ 💰 Кіріс     │ │ 📊 Орт. чек  │ │ ⏳ Өңделуде  │      │
│  │  1,245,670 ₸ │ │    1,400 ₸   │ │     23       │      │
│  │  +15% айына  │ │    +5% аптаға│ │              │      │
│  └──────────────┘ └──────────────┘ └──────────────┘      │
├────────────────────────────────────────────────────────────┤
│  САТЫЛЫМ ГРАФИГІ (соңғы 7 күн)                            │
│  ┌──────────────────────────────────────────────────────┐ │
│  │                                  ▄▄                  │ │
│  │                         ▄▄      ████                 │ │
│  │                ▄▄      ████    ██████                │ │
│  │       ▄▄      ████    ██████  ████████               │ │
│  │ ▄▄   ████    ██████  ████████████████▄▄              │ │
│  │████ ██████  ████████████████████████████             │ │
│  ├──────────────────────────────────────────────────────┤ │
│  │Дс   Сс   Ср   Бс   Жм   Сб   Жк                     │ │
│  └──────────────────────────────────────────────────────┘ │
├────────────────────────────────────────────────────────────┤
│  СОҢҒЫ ТАПСЫРЫСТАР                       [Барлық тапсырыстар→]│
│  ┌──────────────────────────────────────────────────────┐ │
│  │ #1234  Иван Петров   3 тауар    2,600 ₸   Pending   │ │
│  │ #1233  Мария Иванова 5 тауар    4,500 ₸   Processing│ │
│  │ #1232  Петр Сидоров  2 тауар    1,200 ₸   Completed │ │
│  └──────────────────────────────────────────────────────┘ │
└────────────────────────────────────────────────────────────┘
```

**Функциялар:**
- Негізгі метрикалардың визуализациясы
- Сатылым графиктері
- Соңғы тапсырыстарға жылдам қол жеткізу
- Басқарудың барлық бөлімдері бойынша навигация

---

### 2.3.3. UI/UX жобалау қағидалары

#### 1. Консистенттілік (Бірыңғайлық)

- Бірдей элементтер қосымшаның барлық бөліктерінде бірдей көрінеді және жұмыс істейді
- Бірыңғай түс схемасы (фонға сұр градиенттер, батырмаларға primary түс)
- Элементтердің бірыңғай аралықтары мен өлшемдері (Tailwind CSS қамтамасыз етеді)

#### 2. Бейімделгіштік (Responsive Design)

- Интерфейс әр түрлі экран өлшемдеріне бейімделеді
- Мобильді: 1 баған тауарлар, планшетте: 2, десктопта: 3-4
- Мобильдіде навигация бургер-меню болады

#### 3. Кері байланыс

- Әрбір әрекетте пайдаланушы хабарлама алады
- "Тауар себетке қосылды" ✅
- "Қате: қоймада тауар жеткіліксіз" ❌
- Батырмаларға көрсеткішпен көрсеткенде анимациялар

#### 4. Минимализм

- Экранда тек қажетті ақпарат
- Артық жүктеме жоқ
- Блоктарды визуалды бөлу үшін ақ кеңістік

#### 5. Қолжетімділік (Accessibility)

- Мәтін мен фонның жеткілікті контрасты
- Белгішелерге жазулар
- Пернетақтадан навигация мүмкіндігі

---

**Жобалық бөлім бойынша қорытындылар:**

1. Frontend, backend және дерекқорға бөлінген үш деңгейлі клиент-сервер архитектурасы жобаланды.

2. 13 функционалдық модульге бөлінген 59 endpoints бар REST API құрылымы әзірленді.

3. Байланыстар мен тұтастық шектеулері орнатылған 9 кестеден тұратын реляциялық дерекқор жобаланды.

4. Деректер қауіпсіздігі шаралары іске асырылды: құпия сөздерді хэштеу (bcrypt), SQL-инъекциялардан қорғау (SQLAlchemy ORM), JWT-аутентификация, дерекқор деңгейінде тексеру.

5. Үш панельмен (сатып алушы, сатушы, әкімші) пайдаланушы интерфейсі жобаланды, бұл жүйемен ыңғайлы өзара әрекеттесуді қамтамасыз етеді.

6. Sitemap әзірленді және UX/UI дизайн қағидаларын сақтай отырып, негізгі беттердің макеттері сипатталды.
